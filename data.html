<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 14 External data | R Packages</title>
<meta name="author" content="Hadley Wickham">
<meta name="author" content="Jennifer Bryan">
<meta name="description" content="It’s often useful to include data in a package. If you’re releasing the package to a broad audience, it’s a way to provide compelling use cases for the package’s functions. If you’re releasing the...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 14 External data | R Packages">
<meta property="og:type" content="book">
<meta property="og:url" content="https://r-pkgs.org/data.html">
<meta property="og:image" content="https://r-pkgs.org/images/cover.png">
<meta property="og:description" content="It’s often useful to include data in a package. If you’re releasing the package to a broad audience, it’s a way to provide compelling use cases for the package’s functions. If you’re releasing the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 14 External data | R Packages">
<meta name="twitter:site" content="@hadley">
<meta name="twitter:description" content="It’s often useful to include data in a package. If you’re releasing the package to a broad audience, it’s a way to provide compelling use cases for the package’s functions. If you’re releasing the...">
<meta name="twitter:image" content="https://r-pkgs.org/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-141182576-1"></script><script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-141182576-1');
  </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Packages</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome!</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li class="book-part">Getting started</li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="whole-game.html"><span class="header-section-number">2</span> The whole game</a></li>
<li><a class="" href="setup.html"><span class="header-section-number">3</span> System setup</a></li>
<li><a class="" href="package-structure-state.html"><span class="header-section-number">4</span> Package structure and state</a></li>
<li><a class="" href="workflows101.html"><span class="header-section-number">5</span> Fundamental development workflows</a></li>
<li><a class="" href="package-within.html"><span class="header-section-number">6</span> The package within</a></li>
<li class="book-part">Package components</li>
<li><a class="" href="r.html"><span class="header-section-number">7</span> R code</a></li>
<li><a class="" href="description.html"><span class="header-section-number">8</span> Package metadata</a></li>
<li><a class="" href="license.html"><span class="header-section-number">9</span> Licensing</a></li>
<li><a class="" href="man.html"><span class="header-section-number">10</span> Object documentation</a></li>
<li><a class="" href="vignettes.html"><span class="header-section-number">11</span> Vignettes: long-form documentation</a></li>
<li><a class="" href="tests.html"><span class="header-section-number">12</span> Testing</a></li>
<li><a class="" href="namespace.html"><span class="header-section-number">13</span> Namespace</a></li>
<li><a class="active" href="data.html"><span class="header-section-number">14</span> External data</a></li>
<li><a class="" href="src.html"><span class="header-section-number">15</span> Compiled code</a></li>
<li><a class="" href="inst.html"><span class="header-section-number">16</span> Installed files</a></li>
<li><a class="" href="misc.html"><span class="header-section-number">17</span> Other components</a></li>
<li class="book-part">Sharing with others</li>
<li><a class="" href="git.html"><span class="header-section-number">18</span> Git and GitHub</a></li>
<li><a class="" href="r-cmd-check.html"><span class="header-section-number">19</span> Automated checking</a></li>
<li><a class="" href="release.html"><span class="header-section-number">20</span> Releasing a package</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/hadley/r-pkgs">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data" class="section level1">
<h1>
<span class="header-section-number">14</span> External data<a class="anchor" aria-label="anchor" href="#data"><i class="fas fa-link"></i></a>
</h1>
<p>It’s often useful to include data in a package. If you’re releasing the package to a broad audience, it’s a way to provide compelling use cases for the package’s functions. If you’re releasing the package to a more specific audience, interested either in the data (e.g., NZ census data) or the subject (e.g., demography), it’s a way to distribute that data along with its documentation (as long as your audience is R users).</p>
<p>There are three main ways to include data in your package, depending on what you want to do with it and who should be able to use it:</p>
<ul>
<li><p>If you want to store binary data and make it available to the user, put it
in <code>data/</code>. This is the best place to put example datasets.</p></li>
<li><p>If you want to store parsed data, but not make it available to the user,
put it in <code>R/sysdata.rda</code>. This is the best place to put data that your
functions need.</p></li>
<li><p>If you want to store raw data, put it in <code>inst/extdata</code>.</p></li>
</ul>
<p>A simple alternative to these three options is to include it in the source of your package, either creating by hand, or using <code><a href="https://rdrr.io/r/base/dput.html">dput()</a></code> to serialise an existing data set into R code.</p>
<p>Each possible location is described in more detail below.</p>
<div id="data-data" class="section level2">
<h2>
<span class="header-section-number">14.1</span> Exported data<a class="anchor" aria-label="anchor" href="#data-data"><i class="fas fa-link"></i></a>
</h2>
<p>The most common location for package data is (surprise!) <code>data/</code>. Each file in this directory should be a <code>.RData</code> file created by <code><a href="https://rdrr.io/r/base/save.html">save()</a></code> containing a single object (with the same name as the file). The easiest way to adhere to these rules is to use <code><a href="https://usethis.r-lib.org/reference/use_data.html">usethis::use_data()</a></code>:</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>
<span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">mtcars</span><span class="op">)</span></code></pre></div>
<p>It’s possible to use other types of files, but I don’t recommend it because <code>.RData</code> files are already fast, small and explicit. Other options are described in <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code>. For larger datasets, you may want to experiment with the compression setting. The default is <code>bzip2</code>, but sometimes <code>gzip</code> or <code>xz</code> can create smaller files.</p>
<p>If the <code>DESCRIPTION</code> contains <code>LazyData: true</code>, then datasets will be lazily loaded. This means that they won’t occupy any memory until you use them. The following example shows memory usage before and after loading the nycflights13 package. You can see that memory usage doesn’t change until you inspect the flights dataset stored inside the package.</p>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/mem_used.html">mem_used</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 49.2 MB</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span>
<span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/mem_used.html">mem_used</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 57 MB</span>

<span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span>
<span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/mem_used.html">mem_used</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 97.7 MB</span></code></pre></div>
<p>I recommend that you always include <code>LazyData: true</code> in your <code>DESCRIPTION</code>. <code><a href="https://usethis.r-lib.org/reference/create_package.html">usethis::create_package()</a></code> does this for you.</p>
<p>Often, the data you include in <code>data/</code> is a cleaned up version of raw data you’ve gathered from elsewhere. I highly recommend taking the time to include the code used to do this in the source version of your package. This will make it easy for you to update or reproduce your version of the data. I suggest that you put this code in <code>data-raw/</code>. You don’t need it in the bundled version of your package, so also add it to <code>.Rbuildignore</code>. Do all this in one step with:</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data_raw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>You can see this approach in practice in some of my recent data packages. I’ve been creating these as packages because the data will rarely change, and because multiple packages can then use them for examples:</p>
<ul>
<li><a href="https://github.com/hadley/babynames">babynames</a></li>
<li><a href="https://github.com/hadley/fueleconomy">fueleconomy</a></li>
<li><a href="https://github.com/hadley/nasaweather">nasaweather</a></li>
<li><a href="https://github.com/hadley/nycflights13">nycflights13</a></li>
<li><a href="https://github.com/hadley/usdanutrients">usdanutrients</a></li>
</ul>
<div id="documenting-data" class="section level3">
<h3>
<span class="header-section-number">14.1.1</span> Documenting datasets<a class="anchor" aria-label="anchor" href="#documenting-data"><i class="fas fa-link"></i></a>
</h3>
<p>Objects in <code>data/</code> are always effectively exported (they use a slightly different mechanism than <code>NAMESPACE</code> but the details are not important). This means that they must be documented. Documenting data is like documenting a function with a few minor differences. Instead of documenting the data directly, you document the name of the dataset and save it in <code>R/</code>. For example, the roxygen2 block used to document the diamonds data in ggplot2 is saved as <code>R/data.R</code> and looks something like this:</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Prices of 50,000 round cut diamonds.</span>
<span class="co">#'</span>
<span class="co">#' A dataset containing the prices and other attributes of almost 54,000</span>
<span class="co">#' diamonds.</span>
<span class="co">#'</span>
<span class="co">#' @format A data frame with 53940 rows and 10 variables:</span>
<span class="co">#' \describe{</span>
<span class="co">#'   \item{price}{price, in US dollars}</span>
<span class="co">#'   \item{carat}{weight of the diamond, in carats}</span>
<span class="co">#'   ...</span>
<span class="co">#' }</span>
<span class="co">#' @source \url{http://www.diamondse.info/}</span>
<span class="st">"diamonds"</span></code></pre></div>
<p>There are two additional tags that are important for documenting datasets:</p>
<ul>
<li><p><code>@format</code> gives an overview of the dataset. For data frames, you
should include a definition list that describes each variable. It’s usually
a good idea to describe variables’ units here.</p></li>
<li><p><code>@source</code> provides details of where you got the data, often a <code>\url{}</code>.</p></li>
</ul>
<p>Never <code>@export</code> a data set.</p>
</div>
</div>
<div id="data-sysdata" class="section level2">
<h2>
<span class="header-section-number">14.2</span> Internal data<a class="anchor" aria-label="anchor" href="#data-sysdata"><i class="fas fa-link"></i></a>
</h2>
<p>Sometimes functions need pre-computed data tables. If you put these in <code>data/</code> they’ll also be available to package users, which is not appropriate. Instead, you can save them in <code>R/sysdata.rda</code>. For example, two colour-related packages, <a href="https://github.com/cwickham/munsell">munsell</a> and <a href="https://cran.r-project.org/web/packages/dichromat/index.html">dichromat</a>, use <code>R/sysdata.rda</code> to store large tables of colour data.</p>
<p>You can use <code><a href="https://usethis.r-lib.org/reference/use_data.html">usethis::use_data()</a></code> to create this file with the argument <code>internal = TRUE</code>:</p>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>
<span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">mtcars</span>, internal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Again, to make this data reproducible it’s a good idea to include the code used to generate it. Put it in <code>data-raw/</code>.</p>
<p>Objects in <code>R/sysdata.rda</code> are not exported (they shouldn’t be), so they don’t need to be documented. They’re only available inside your package.</p>
</div>
<div id="data-extdata" class="section level2">
<h2>
<span class="header-section-number">14.3</span> Raw data<a class="anchor" aria-label="anchor" href="#data-extdata"><i class="fas fa-link"></i></a>
</h2>
<p>If you want to show examples of loading/parsing raw data, put the original files in <code>inst/extdata</code>. When the package is installed, all files (and folders) in <code>inst/</code> are moved up one level to the top-level directory (so they can’t have names like <code>R/</code> or <code>DESCRIPTION</code>). To refer to files in <code>inst/extdata</code> (whether installed or not), use <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code>. For example, the <a href="https://readr.tidyverse.org">readr</a> package uses <code>inst/extdata</code> to store delimited files for use in examples:</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"mtcars.csv"</span>, package <span class="op">=</span> <span class="st">"readr"</span><span class="op">)</span>
<span class="co">#&gt; [1] "/home/runner/work/_temp/Library/readr/extdata/mtcars.csv"</span></code></pre></div>
<p>Beware: by default, if the file does not exist, <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> does not return an error - it just returns the empty string:</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"iris.csv"</span>, package <span class="op">=</span> <span class="st">"readr"</span><span class="op">)</span>
<span class="co">#&gt; [1] ""</span></code></pre></div>
<p>If you want to have an error message when the file does not exist, add the argument <code>mustWork = TRUE</code>:</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"iris.csv"</span>, package <span class="op">=</span> <span class="st">"readr"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Error in system.file("extdata", "iris.csv", package = "readr", mustWork = TRUE): no file found</span></code></pre></div>
</div>
<div id="other-data" class="section level2">
<h2>
<span class="header-section-number">14.4</span> Other data<a class="anchor" aria-label="anchor" href="#other-data"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p>Data for tests: it’s ok to put small files directly in your test directory.
But remember unit tests are for testing correctness, not performance, so keep
the size small.</p></li>
<li><p>Data for vignettes. If you want to show how to work with an already loaded
dataset, put that data in <code>data/</code>. If you want to show how to load raw data,
put that data in <code>inst/extdata.</code></p></li>
</ul>
</div>
<div id="data-cran" class="section level2">
<h2>
<span class="header-section-number">14.5</span> CRAN notes<a class="anchor" aria-label="anchor" href="#data-cran"><i class="fas fa-link"></i></a>
</h2>
<p>Generally, package data should be smaller than a megabyte - if it’s larger you’ll need to argue for an exemption. This is usually easier to do if the data is in its own package and won’t be updated frequently. You should also make sure that the data has been optimally compressed:</p>
<ol style="list-style-type: decimal">
<li><p>Run <code><a href="https://rdrr.io/r/tools/checkRdaFiles.html">tools::checkRdaFiles()</a></code> to determine the best compression for each file.</p></li>
<li><p>Re-run <code><a href="https://usethis.r-lib.org/reference/use_data.html">usethis::use_data()</a></code> with <code>compress</code> set to that optimal value.
If you’ve lost the code for recreating the files, you can use
<code><a href="https://rdrr.io/r/tools/checkRdaFiles.html">tools::resaveRdaFiles()</a></code> to re-save in place.</p></li>
</ol>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="namespace.html"><span class="header-section-number">13</span> Namespace</a></div>
<div class="next"><a href="src.html"><span class="header-section-number">15</span> Compiled code</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data"><span class="header-section-number">14</span> External data</a></li>
<li>
<a class="nav-link" href="#data-data"><span class="header-section-number">14.1</span> Exported data</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#documenting-data"><span class="header-section-number">14.1.1</span> Documenting datasets</a></li></ul>
</li>
<li><a class="nav-link" href="#data-sysdata"><span class="header-section-number">14.2</span> Internal data</a></li>
<li><a class="nav-link" href="#data-extdata"><span class="header-section-number">14.3</span> Raw data</a></li>
<li><a class="nav-link" href="#other-data"><span class="header-section-number">14.4</span> Other data</a></li>
<li><a class="nav-link" href="#data-cran"><span class="header-section-number">14.5</span> CRAN notes</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/hadley/r-pkgs/blob/main/data.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/hadley/r-pkgs/edit/main/data.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Packages</strong>" was written by Hadley Wickham, Jennifer Bryan. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
