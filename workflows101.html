<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Fundamental development workflows | R Packages</title>
<meta name="author" content="Hadley Wickham">
<meta name="author" content="Jennifer Bryan">
<meta name="description" content="Having peeked under the hood of R packages and libraries in Chapter 4, here we provide the basic workflows for creating a package and moving it through the different states that come up during...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="Chapter 5 Fundamental development workflows | R Packages">
<meta property="og:type" content="book">
<meta property="og:url" content="https://r-pkgs.org/workflows101.html">
<meta property="og:image" content="https://r-pkgs.org/images/cover.png">
<meta property="og:description" content="Having peeked under the hood of R packages and libraries in Chapter 4, here we provide the basic workflows for creating a package and moving it through the different states that come up during...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Fundamental development workflows | R Packages">
<meta name="twitter:site" content="@hadley">
<meta name="twitter:description" content="Having peeked under the hood of R packages and libraries in Chapter 4, here we provide the basic workflows for creating a package and moving it through the different states that come up during...">
<meta name="twitter:image" content="https://r-pkgs.org/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-141182576-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-141182576-1');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Packages</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome!</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li class="book-part">Getting started</li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="whole-game.html"><span class="header-section-number">2</span> The whole game</a></li>
<li><a class="" href="setup.html"><span class="header-section-number">3</span> System setup</a></li>
<li><a class="" href="package-structure-state.html"><span class="header-section-number">4</span> Package structure and state</a></li>
<li><a class="active" href="workflows101.html"><span class="header-section-number">5</span> Fundamental development workflows</a></li>
<li><a class="" href="package-within.html"><span class="header-section-number">6</span> The package within</a></li>
<li class="book-part">Package components</li>
<li><a class="" href="r.html"><span class="header-section-number">7</span> R code</a></li>
<li><a class="" href="data.html"><span class="header-section-number">8</span> Data</a></li>
<li><a class="" href="misc.html"><span class="header-section-number">9</span> Other components</a></li>
<li class="book-part">Package metadata</li>
<li><a class="" href="description-and-namespace.html"><span class="header-section-number">10</span> DESCRIPTION and NAMESPACE</a></li>
<li><a class="" href="description-dependencies.html"><span class="header-section-number">11</span> Dependencies: What does your package need?</a></li>
<li><a class="" href="license.html"><span class="header-section-number">12</span> Licensing</a></li>
<li class="book-part">Testing</li>
<li><a class="" href="tests.html"><span class="header-section-number">13</span> Testing</a></li>
<li class="book-part">Documentation</li>
<li><a class="" href="doc-intro.html"><span class="header-section-number">14</span> Introduction</a></li>
<li><a class="" href="man.html"><span class="header-section-number">15</span> Function documentation</a></li>
<li><a class="" href="vignettes.html"><span class="header-section-number">16</span> Vignettes</a></li>
<li><a class="" href="important-files.html"><span class="header-section-number">17</span> Other markdown files</a></li>
<li><a class="" href="website.html"><span class="header-section-number">18</span> Website</a></li>
<li class="book-part">Maintenance and distribution</li>
<li><a class="" href="r-cmd-check.html"><span class="header-section-number">19</span> R CMD check</a></li>
<li><a class="" href="lifecycle.html"><span class="header-section-number">20</span> Lifecycle</a></li>
<li><a class="" href="continuous-integration.html"><span class="header-section-number">21</span> Continuous integration</a></li>
<li><a class="" href="release.html"><span class="header-section-number">22</span> Releasing to CRAN</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/hadley/r-pkgs">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="workflows101" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Fundamental development workflows<a class="anchor" aria-label="anchor" href="#workflows101"><i class="fas fa-link"></i></a>
</h1>
<p>Having peeked under the hood of R packages and libraries in Chapter <a href="package-structure-state.html#package-structure-state">4</a>, here
we provide the basic workflows for creating a package and moving it through the different states that come up during development.</p>
<div id="create-a-package" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Create a package<a class="anchor" aria-label="anchor" href="#create-a-package"><i class="fas fa-link"></i></a>
</h2>
<div id="survey-the-existing-landscape" class="section level3" number="5.1.1">
<h3>
<span class="header-section-number">5.1.1</span> Survey the existing landscape<a class="anchor" aria-label="anchor" href="#survey-the-existing-landscape"><i class="fas fa-link"></i></a>
</h3>
<!-- TODO: would love to put some version of the "geeks and repetitive tasks" figure here, but it would take more time than I want to spend right now to figure out original source, licensing, etc. Revisit when I do a concentrated push on figures. -->
<p>Many packages are born out of one person’s frustration at some common task that should be easier. How should you decide whether something is package-worthy? There’s no definitive answer, but it’s helpful to appreciate at least two types of payoff:</p>
<ul>
<li>Product: your life will be better when this functionality is implemented
formally, in a package.</li>
<li>Process: greater mastery of R will make you more effective in your work.</li>
</ul>
<p>If all you care about is the existence of a product, then your main goal is to navigate the space of existing packages. Silge, Nash, and Graves organized a survey and sessions around this at useR! 2017 and their write up for the R Journal <span class="citation">(<a href="release.html#ref-silge-nash-graves" role="doc-biblioref">Silge, Nash, and Graves 2018</a>)</span> provides a comprehensive roundup of resources.</p>
<p>If you are looking for ways to increase your R mastery, you should still educate yourself about the landscape. But there are plenty of good reasons to make your own package, even if there is relevant prior work. The way experts got that way is by actually building things, often very basic things, and you deserve the same chance to learn by tinkering. If you’re only allowed to work on things that have never been touched, you’re likely looking at problems that are either very obscure or very difficult.</p>
<p>Finally, it’s also valid to evaluate the suitability of existing tools on the basis of user interface, defaults, and edge case behaviour. If a package can technically do what you need, but it’s very unergonomic for your use case, it’s fair to say it doesn’t meet your needs. In this case, it can still make sense for you to develop your own implementation or to write wrapper functions that hide the sharp edges.</p>
<p>If your work falls into a well-defined domain, educate yourself about the existing R packages, even if you’ve resolved to create your own package. Do they follow specific design patterns? Are there specific data structures that are common as the primary input and output? For example, there is a very active R community around spatial data analysis (<a href="https://www.r-spatial.org">r-spatial.org</a>) that has successfully self-organised to promote greater consistency across packages with different maintainers. In modeling, the <a href="https://hardhat.tidymodels.org">hardhat package</a> provides scaffolding for creating a modeling package that plays well with the <a href="https://www.tidymodels.org">tidymodels</a> ecosystem. Your package will get more usage and will need less documentation if it fits nicely into the surrounding landscape.</p>
</div>
<div id="naming" class="section level3" number="5.1.2">
<h3>
<span class="header-section-number">5.1.2</span> Name your package<a class="anchor" aria-label="anchor" href="#naming"><i class="fas fa-link"></i></a>
</h3>
<blockquote>
<p>“There are only two hard things in Computer Science: cache invalidation and
naming things.”</p>
<p>— Phil Karlton</p>
</blockquote>
<p>Before you can create your package, you need to come up with a name for it. This can be the hardest part of creating a package! (Not least because no one can automate it for you.)</p>
<div id="formal-requirements" class="section level4" number="5.1.2.1">
<h4>
<span class="header-section-number">5.1.2.1</span> Formal requirements<a class="anchor" aria-label="anchor" href="#formal-requirements"><i class="fas fa-link"></i></a>
</h4>
<p>There are three formal requirements:</p>
<ol style="list-style-type: decimal">
<li>The name can only consist of letters, numbers, and periods, i.e., <code>.</code>.</li>
<li>It must start with a letter.</li>
<li>It cannot end with a period.</li>
</ol>
<p>Unfortunately, this means you can’t use either hyphens or underscores, i.e., <code>-</code> or <code>_</code>, in your package name. We recommend against using periods in package names, due to confusing associations with file extensions and S3 methods.</p>
</div>
<div id="pragmatic-advice" class="section level4" number="5.1.2.2">
<h4>
<span class="header-section-number">5.1.2.2</span> Pragmatic advice<a class="anchor" aria-label="anchor" href="#pragmatic-advice"><i class="fas fa-link"></i></a>
</h4>
<p>If you plan to share your package with others, it’s worth spending a few minutes to come up with a good name. Here are some things to consider:</p>
<ul>
<li><p>Pick a unique name that’s easy to Google. This makes it easy for potential
users to find your package (and associated resources) and for you to see who’s
using it.</p></li>
<li>
<p>Don’t pick a name that’s already in use on CRAN or Bioconductor. You may
also want to consider some other types of name collision:</p>
<ul>
<li>Is there an in-development package maturing on, say, GitHub that already
has some history and seems to be heading towards release?</li>
<li>Is this name already used for another piece of software or for a library or
framework in, e.g., the Python or JavaScript ecosystem?</li>
</ul>
</li>
<li><p>Avoid using both upper and lower case letters: doing so makes the package name
hard to type and even harder to remember. For example, it’s hard to remember
if it’s Rgtk2 or RGTK2 or RGtk2.</p></li>
<li><p>Give preference to names that are pronounceable, so people are comfortable
talking about your package and have a way to hear it inside their head.</p></li>
<li>
<p>Find a word that evokes the problem and modify it so that it’s unique:</p>
<ul>
<li>lubridate makes dates and times easier.</li>
<li>rvest “harvests” the content from web pages.</li>
<li>r2d3 provides utilities for working with D3 visualisations.</li>
<li>forcats is an anagram of factors, which we use <strong>for</strong> <b>cat</b>egorical data.</li>
</ul>
</li>
<li>
<p>Use abbreviations:</p>
<ul>
<li>Rcpp = R + C++ (plus plus)</li>
<li>brms = Bayesian Regression Models using Stan</li>
</ul>
</li>
<li>
<p>Add an extra R:</p>
<ul>
<li>stringr provides string tools.</li>
<li>beepr plays notification sounds.</li>
<li>callr calls R, from R.</li>
</ul>
</li>
<li>
<p>Don’t get sued.</p>
<ul>
<li>If you’re creating a package that talks to a commercial service, check the
branding guidelines. For example, rDrop isn’t called rDropbox because
Dropbox prohibits any applications from using the full trademarked name.</li>
</ul>
</li>
</ul>
<p>Nick Tierney presents a fun typology of package names in his <a href="https://www.njtierney.com/post/2018/06/20/naming-things/">Naming Things</a> blog post; see that for more inspiring examples. He also has some experience with renaming packages, so the post <a href="https://www.njtierney.com/post/2017/10/27/change-pkg-name/">So, you’ve decided to change your r package name</a> is a good resource if you don’t get this right the first time.</p>
</div>
<div id="use-the-available-package" class="section level4" number="5.1.2.3">
<h4>
<span class="header-section-number">5.1.2.3</span> Use the available package<a class="anchor" aria-label="anchor" href="#use-the-available-package"><i class="fas fa-link"></i></a>
</h4>
<p>It is impossible to abide by all of the above suggestions simultaneously, so obviously you will need to make some trade-offs. The <a href="https://cran.r-project.org/package=available">available package</a> has a function called <code>available()</code> that helps you evaluate a potential package name from many angles:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/available">available</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">available</span><span class="op">(</span><span class="st">"doofus"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Urban Dictionary can contain potentially offensive results,</span></span>
<span><span class="co">#&gt;   should they be included? [Y]es / [N]o:</span></span>
<span><span class="co">#&gt; 1: 1</span></span>
<span><span class="co">#&gt; ── doofus ──────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Name valid: ✔</span></span>
<span><span class="co">#&gt; Available on CRAN: ✔ </span></span>
<span><span class="co">#&gt; Available on Bioconductor: ✔</span></span>
<span><span class="co">#&gt; Available on GitHub:  ✔ </span></span>
<span><span class="co">#&gt; Abbreviations: http://www.abbreviations.com/doofus</span></span>
<span><span class="co">#&gt; Wikipedia: https://en.wikipedia.org/wiki/doofus</span></span>
<span><span class="co">#&gt; Wiktionary: https://en.wiktionary.org/wiki/doofus</span></span>
<span><span class="co">#&gt; Sentiment:???</span></span></code></pre></div>
<p><code>available::available()</code> does the following:</p>
<ul>
<li>Checks for validity.</li>
<li>Checks availability on CRAN, Bioconductor, and beyond.</li>
<li>Searches various websites to help you discover any unintended meanings. In an
interactive session, the URLs you see above are opened in browser tabs.</li>
<li>Attempts to report whether name has positive or negative sentiment.</li>
</ul>
</div>
</div>
<div id="creating" class="section level3" number="5.1.3">
<h3>
<span class="header-section-number">5.1.3</span> Package creation<a class="anchor" aria-label="anchor" href="#creating"><i class="fas fa-link"></i></a>
</h3>
<p>Once you’ve come up with a name, there are two ways to create the package.</p>
<ul>
<li>Call <code><a href="https://usethis.r-lib.org/reference/create_package.html">usethis::create_package()</a></code>.</li>
<li>In RStudio, do <em>File &gt; New Project &gt; New Directory &gt; R Package</em>. This
ultimately calls <code><a href="https://usethis.r-lib.org/reference/create_package.html">usethis::create_package()</a></code>, so really there’s just one
way.</li>
</ul>
<p><em>TODO: revisit when I tackle usethis + RStudio project templates <a href="https://github.com/r-lib/usethis/issues/770" class="uri">https://github.com/r-lib/usethis/issues/770</a>. In particular, contemplate whether to reinstate any screenshot-y coverage of RStudio workflows here.</em></p>
<p>This produces the smallest possible <em>working</em> package, with three components:</p>
<ol style="list-style-type: decimal">
<li><p>An <code>R/</code> directory, which you’ll learn about in <a href="r.html#r">R code</a>.</p></li>
<li><p>A basic <code>DESCRIPTION</code> file, which you’ll learn about in
<a href="description-and-namespace.html#description">package metadata</a>.</p></li>
<li><p>A basic <code>NAMESPACE</code> file, which you’ll learn about in
<a href="description-dependencies.html#namespace">the namespace</a>.</p></li>
</ol>
<p>It may also include an RStudio project file, <code>pkgname.Rproj</code>, that makes your package easy to use with RStudio, as described below. Basic <code>.Rbuildignore</code> and <code>.gitignore</code> files are also left behind.</p>
<p>Don’t use <code><a href="https://rdrr.io/r/utils/package.skeleton.html">package.skeleton()</a></code> to create a package. Because this function comes with R, you might be tempted to use it, but it creates a package that immediately throws errors with <code>R CMD build</code>. It anticipates a different development process than we use here, so repairing this broken initial state just makes unnecessary work for people who use devtools (and, especially, roxygen2). Use <code><a href="https://usethis.r-lib.org/reference/create_package.html">create_package()</a></code>.</p>
</div>
<div id="where-source-package" class="section level3" number="5.1.4">
<h3>
<span class="header-section-number">5.1.4</span> Where should you <code>create_package()</code>?<a class="anchor" aria-label="anchor" href="#where-source-package"><i class="fas fa-link"></i></a>
</h3>
<p>The main and only required argument to <code><a href="https://usethis.r-lib.org/reference/create_package.html">create_package()</a></code> is the <code>path</code> where your new package will live:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://usethis.r-lib.org/reference/create_package.html">create_package</a></span><span class="op">(</span><span class="st">"path/to/package/pkgname"</span><span class="op">)</span></span></code></pre></div>
<p>Remember that this is where your package lives in its <strong>source</strong> form (section <a href="package-structure-state.html#source-package">4.2</a>), not in its <strong>installed</strong> form (section <a href="package-structure-state.html#installed-package">4.5</a>). Installed packages live in a <strong>library</strong> and we discussed conventional setups for libraries in section <a href="package-structure-state.html#library">4.7</a>.</p>
<p>Where should you keep source packages? The main principle is that this location should be distinct from where installed packages live. In the absence of external considerations, a typical user should designate a directory inside their home directory for R (source) packages. We discussed this with colleagues and the source of some of your favorite R packages lives inside directories like <code>~/rrr/</code>, <code>~/documents/tidyverse/</code>, <code>~/r/packages/</code>, or <code>~/pkg/</code>. Some of us use one directory for this, others divide source packages among a few directories based on their development role (contributor vs. not), GitHub organization (tidyverse vs r-lib), development stage (active vs. not), and so on.</p>
<p>The above probably reflects that we are primarily tool-builders. An academic researcher might organize their files around individual publications, whereas a data scientist might organize around data products and reports. There is no particular technical or traditional reason for one specific approach. As long as you keep a clear distinction between source and installed packages, just pick a strategy that works within your overall system for file organization, and use it consistently.</p>
</div>
</div>
<div id="projects" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> RStudio Projects<a class="anchor" aria-label="anchor" href="#projects"><i class="fas fa-link"></i></a>
</h2>
<p>devtools works hand-in-hand with RStudio, which we believe is the best development environment for most R users. To be clear, you can use devtools without using RStudio and you can develop packages in RStudio without using devtools. But there is a special, two-way relationship that makes it very rewarding to use devtools and RStudio together.</p>
<div class="rstudio-tip">
<p>An RStudio <strong>Project</strong>, with a capital “P”, is a regular directory on your computer that includes some (mostly hidden) RStudio infrastructure to facilitate your work on one or more <strong>projects</strong>, with a lowercase “p”. A project might be an R package, a data analysis, a Shiny app, a book, a blog, etc.</p>
</div>
<div id="benefits-of-rstudio-projects" class="section level3" number="5.2.1">
<h3>
<span class="header-section-number">5.2.1</span> Benefits of RStudio Projects<a class="anchor" aria-label="anchor" href="#benefits-of-rstudio-projects"><i class="fas fa-link"></i></a>
</h3>
<p>From section <a href="package-structure-state.html#source-package">4.2</a>, you already know that a source package lives in a directory on your computer. We strongly recommend that each source package is also an RStudio Project. Here are some of the payoffs:</p>
<ul>
<li><p>Projects are very “launch-able”. It’s easy to fire up a fresh instance of
RStudio in a Project, with the file browser and working directory set exactly
the way you need, ready for work.</p></li>
<li>
<p>Each Project is isolated; code run in one Project does not affect any other
Project.</p>
<ul>
<li>You can have several RStudio Projects open at once and code
executed in Project A does not have any effect on the R session and
workspace of Project B.</li>
</ul>
</li>
<li><p>You get handy code navigation tools like <code>F2</code> to jump to a function definition
and <code>Ctrl + .</code> to look up functions or files by name.</p></li>
<li>
<p>You get useful keyboard shortcuts and a clickable interface for common package
development tasks, like generating documentation, running tests, or checking
the entire package.</p>
<div class="inline-figure">
<img src="images/keyboard-shortcuts.png"><!-- -->
</div>
</li>
</ul>
<div class="rstudio-tip">
<p>To see the most useful keyboard shortcuts, press <code>Alt + Shift + K</code> or use <em>Help &gt; Keyboard Shortcuts Help</em>.</p>
</div>
<div class="rstudio-tip">
<p>Follow @<a href="https://twitter.com/rstudiotips">rstudiotips</a> on Twitter for a regular dose of RStudio tips and tricks.</p>
</div>
</div>
<div id="how-to-get-an-rstudio-project" class="section level3" number="5.2.2">
<h3>
<span class="header-section-number">5.2.2</span> How to get an RStudio Project<a class="anchor" aria-label="anchor" href="#how-to-get-an-rstudio-project"><i class="fas fa-link"></i></a>
</h3>
<p>If you follow our recommendation to create new packages with <code><a href="https://usethis.r-lib.org/reference/create_package.html">create_package()</a></code>, this takes care of itself. Each new package will also be an RStudio Project, if you’re working from RStudio.</p>
<p>There are various ways to designate the directory of a pre-existing source package as an RStudio Project:</p>
<ul>
<li>In RStudio, do <em>File &gt; New Project &gt; Existing Directory</em>.</li>
<li>Call <code><a href="https://usethis.r-lib.org/reference/create_package.html">create_package()</a></code> with the path to the pre-existing R source package.</li>
<li>Call <code><a href="https://usethis.r-lib.org/reference/use_rstudio.html">usethis::use_rstudio()</a></code>, with the active usethis project set to an
existing R package. In practice, this probably means you just need to make
sure working directory is inside the pre-existing package.</li>
</ul>
</div>
<div id="what-makes-an-rstudio-project" class="section level3" number="5.2.3">
<h3>
<span class="header-section-number">5.2.3</span> What makes an RStudio Project?<a class="anchor" aria-label="anchor" href="#what-makes-an-rstudio-project"><i class="fas fa-link"></i></a>
</h3>
<p>A directory that is an RStudio Project will contain an <code>.Rproj</code> file. Typically, if the directory is named “foo”, the Project file is <code>foo.Rproj</code>. And if that directory is also an R package, then the package name is usually also “foo”. The path of least resistance is to make all of these names coincide and to NOT nest your package inside a subdirectory inside the Project. If you settle on a different workflow, just know it may feel like you are fighting with the tools.</p>
<p>An <code>.Rproj</code> file is just a text file. Here’s the default project file used by usethis:</p>
<pre><code>Version: 1.0

RestoreWorkspace: No
SaveWorkspace: No
AlwaysSaveHistory: Default

EnableCodeIndexing: Yes
Encoding: UTF-8

AutoAppendNewline: Yes
StripTrailingWhitespace: Yes

BuildType: Package
PackageUseDevtools: Yes
PackageInstallArgs: --no-multiarch --with-keep.source
PackageRoxygenize: rd,collate,namespace</code></pre>
<p>You don’t need to modify this file by hand. Instead, use the interface available via <em>Tools &gt; Project Options</em> or <em>Project Options</em> in the Projects menu in the top-right corner.</p>
<p><em>TODO: update these and deal with layout.</em></p>
<div class="inline-figure"><img src="images/project-options-1.png" width="30%"></div>
<div class="inline-figure"><img src="images/project-options-2.png" width="70%"></div>
</div>
<div id="how-to-launch-an-rstudio-project" class="section level3" number="5.2.4">
<h3>
<span class="header-section-number">5.2.4</span> How to launch an RStudio Project<a class="anchor" aria-label="anchor" href="#how-to-launch-an-rstudio-project"><i class="fas fa-link"></i></a>
</h3>
<p>Double-click the <code>foo.Rproj</code> file in macOS’s Finder or Windows Explorer to launch the foo Project in RStudio.</p>
<p>You can also launch Projects from within RStudio via <em>File &gt; Open Project (in New Session)</em> or the Projects menu in the top-right corner.</p>
<p>If you use a productivity or launcher app, you can probably configure it to do something delightful for <code>.Rproj</code> files. We both use Alfred for this <a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Specifically, we configure Alfred to favor &lt;code&gt;.Rproj&lt;/code&gt; files in its search results when proposing apps or files to open. To register the &lt;code&gt;.Rproj&lt;/code&gt; file type with Alfred, go to &lt;em&gt;Preferences &amp;gt; Features &amp;gt; Default Results &amp;gt; Advanced&lt;/em&gt;. Drag any &lt;code&gt;.Rproj&lt;/code&gt; file onto this space and then close.&lt;/p&gt;"><sup>4</sup></a>, which is macOS only, but similar tools exist for Windows. In fact, this is a very good reason to use a productivity app in the first place.</p>

<p>It is very normal – and productive! – to have multiple Projects open at once.</p>
</div>
<div id="rstudio-project-vs.-active-usethis-project" class="section level3" number="5.2.5">
<h3>
<span class="header-section-number">5.2.5</span> RStudio Project vs. active usethis project<a class="anchor" aria-label="anchor" href="#rstudio-project-vs.-active-usethis-project"><i class="fas fa-link"></i></a>
</h3>
<p>You will notice that most usethis functions don’t take a path: they operate on the files in the “active usethis project”. The usethis package assumes that 95% of the time all of these coincide:</p>
<ul>
<li>The current RStudio Project, if using RStudio.</li>
<li>The active usethis project.</li>
<li>Current working directory for the R process.</li>
</ul>
<p>If things seem funky, call <code><a href="https://usethis.r-lib.org/reference/proj_sitrep.html">proj_sitrep()</a></code> to get a “situation report”. This will identify peculiar situations and propose ways to get back to a happier state.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># these should usually be the same (or unset)</span></span>
<span><span class="fu"><a href="https://usethis.r-lib.org/reference/proj_sitrep.html">proj_sitrep</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; *   working_directory: '/Users/jenny/rrr/readxl'</span></span>
<span><span class="co">#&gt; * active_usethis_proj: '/Users/jenny/rrr/readxl'</span></span>
<span><span class="co">#&gt; * active_rstudio_proj: '/Users/jenny/rrr/readxl'</span></span></code></pre></div>
</div>
</div>
<div id="working-directory-and-filepath-discipline" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Working directory and filepath discipline<a class="anchor" aria-label="anchor" href="#working-directory-and-filepath-discipline"><i class="fas fa-link"></i></a>
</h2>
<p>As you develop your package, you will be executing R code. This will be a mix of workflow calls (e.g., <code><a href="https://devtools.r-lib.org/reference/document.html">document()</a></code> or <code><a href="https://devtools.r-lib.org/reference/test.html">test()</a></code>) and <em>ad hoc</em> calls that help you write your functions, examples, and tests. We <em>strongly recommend</em> that you leave the working directory of your R process set to the top-level of the source package.</p>
<p>If you’re totally new to package development, you don’t have much basis for supporting or resisting this proposal. But those with some experience may find it somewhat upsetting. How are we supposed to express paths when working in subdirectories, like <code>tests/</code>? As it becomes relevant, we’ll show you how to exploit path-building helpers, such as <code><a href="https://testthat.r-lib.org/reference/test_path.html">testthat::test_path()</a></code>, that determine paths at execution time.</p>
<p>The basic idea is that by leaving working directory alone, you are encouraged to write paths that convey intent explicitly (“read <code>foo.csv</code> from the test directory”) instead of implicitly (“read <code>foo.csv</code> from current working directory, which I <em>think</em> is going to be the test directory”). A sure sign of reliance on implicit paths is incessant fiddling with your working directory, because you’re using <code><a href="https://rdrr.io/r/base/getwd.html">setwd()</a></code> to manually fulfill the assumptions that are implicit in your paths.</p>
<p>This mentality can design away a whole class of path headaches and makes day-to-day development more pleasant as well. There are two reasons why implicit paths are hard to get right:</p>
<ul>
<li>Recall the different forms that a package can take during the development
cycle (Chapter <a href="package-structure-state.html#package-structure-state">4</a>). These states differ from
each other in terms of which files and folders exist and their relative
positions within the hierarchy. It’s tricky to write relative paths that
work across all package states.</li>
<li>Eventually, your package will be processed with built-in tools like
<code>R CMD build</code>, <code>R CMD check</code>, and <code>R CMD INSTALL</code>, by you and potentially
CRAN. It’s hard to keep track of what the working directory will be at
every stage of these processes.</li>
</ul>
<p>Path helpers like <code><a href="https://testthat.r-lib.org/reference/test_path.html">testthat::test_path()</a></code>, <code><a href="https://fs.r-lib.org/reference/path_package.html">fs::path_package()</a></code>, and the <a href="https://rprojroot.r-lib.org">rprojroot package</a> are extremely useful for building resilient paths that hold up across the whole range of situations that come up during development and usage. Another way to eliminate brittle paths is to be rigorous in your use of proper methods for storing data inside your package (Chapter <a href="data.html#data">8</a>) and to target the session temp directory when appropriate, such as for ephemeral testing artefacts (Chapter <a href="tests.html#tests">13</a>).</p>
</div>
<div id="load-all" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Test drive with <code>load_all()</code><a class="anchor" aria-label="anchor" href="#load-all"><i class="fas fa-link"></i></a>
</h2>
<p>The <code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code> function is arguably the most important part of the devtools workflow.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># with devtools attached and</span></span>
<span><span class="co"># working directory set to top-level of your source package ...</span></span>
<span></span>
<span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html">load_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ... now experiment with the functions in your package</span></span></code></pre></div>
<p><code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code> is the key step in this “lather, rinse, repeat” cycle of package development:</p>
<ol style="list-style-type: decimal">
<li>Tweak a function definition.</li>
<li><code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code></li>
<li>Try out the change by running a small example or some tests.</li>
</ol>
<p>When you’re new to package development or to devtools, it’s easy to overlook the importance of <code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code> and fall into some awkward habits from a data analysis workflow.</p>
<div id="benefits-of-load_all" class="section level3" number="5.4.1">
<h3>
<span class="header-section-number">5.4.1</span> Benefits of <code>load_all()</code><a class="anchor" aria-label="anchor" href="#benefits-of-load_all"><i class="fas fa-link"></i></a>
</h3>
<p>When you first start to use a development environment, like RStudio or Emacs + ESS, the biggest win is the ability to send lines of code from an <code>.R</code> script for execution in R console. The fluidity of this is what makes it tolerable to follow the best practice of regarding your source code as real <a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Quoting the usage philosophy favored by &lt;a href="https://ess.r-project.org/Manual/ess.html#Philosophies-for-using-ESS_0028R_0029"&gt;Emacs Speaks Statistics&lt;/a&gt; (ESS).&lt;/p&gt;'><sup>5</sup></a> (as opposed to objects in the workspace) and saving <code>.R</code> files (as opposed to saving and reloading <code>.Rdata</code>).</p>

<p><code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code> has the same significance for package development and, ironically, requires that you NOT test drive package code in the same way as script code. <code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code> <em>simulates</em> the fullblown process for seeing the effect of a source code change, which is clunky enough <a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;The command line approach is to quit R, go to the shell, do &lt;code&gt;R CMD build foo&lt;/code&gt; in the package’s parent directory, then &lt;code&gt;R CMD INSTALL foo_x.y.x.tar.gz&lt;/code&gt;, restart R, and call &lt;code&gt;library(foo&lt;/code&gt;). From R, an approximation is to &lt;code&gt;detach("package:foo", unload = TRUE); install.packages(".", repos = NULL, type = "source"); library(foo)&lt;/code&gt;.&lt;/p&gt;'><sup>6</sup></a> that you won’t want to do it very often. The main benefits of <code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code>:</p>
<ul>
<li>You can iterate quickly, which encourages exploration and incremental
progress.
<ul>
<li>This iterative speedup is especially noticeable for packages with
compiled code.</li>
</ul>
</li>
<li>You get to develop interactively under a namespace regime that accurately
mimics how things are when someone uses your installed package:
<ul>
<li>You can call your own internal functions directly, without using <code>:::</code>
and without being tempted to temporarily define your functions in the
global workspace.</li>
<li>You can also call functions from other packages that you’ve imported into
your <code>NAMESPACE</code>, without being tempted to attach these dependencies via
<code><a href="https://rdrr.io/r/base/library.html">library()</a></code>.</li>
</ul>
</li>
</ul>
<p><code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code> removes friction from the development workflow and eliminates the temptation to use workarounds that often lead to mistakes around namespace and dependency management.</p>
</div>
<div id="other-ways-to-call-load_all" class="section level3" number="5.4.2">
<h3>
<span class="header-section-number">5.4.2</span> Other ways to call <code>load_all()</code><a class="anchor" aria-label="anchor" href="#other-ways-to-call-load_all"><i class="fas fa-link"></i></a>
</h3>
<p>When working in a Project that is a package, RStudio offers several ways to call <code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code>:</p>
<ul>
<li>Keyboard shortcut: Cmd+Shift+L (macOS), Ctrl+Shift+L (Windows, Linux)</li>
<li>Build pane’s <em>More …</em> menu</li>
<li><em>Build &gt; Load All</em></li>
</ul>
<p><code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all()</a></code> is a thin wrapper around <code><a href="https://pkgload.r-lib.org/reference/load_all.html">pkgload::load_all()</a></code> that adds a bit of user-friendliness. It is unlikely you will use <code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code> programatically or inside another package, but if you do, you should probably use <code><a href="https://pkgload.r-lib.org/reference/load_all.html">pkgload::load_all()</a></code> directly.</p>
<p><em>TODO: Decide how to update this diagram and then reposition and re-integrate it with the prose. For example, figure out how to frame w.r.t. RStudio Install and Restart vs. Clean and Rebuild.</em></p>
<div class="inline-figure">
<img src="diagrams/loading.png"><!-- -->
</div>

</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="package-structure-state.html"><span class="header-section-number">4</span> Package structure and state</a></div>
<div class="next"><a href="package-within.html"><span class="header-section-number">6</span> The package within</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#workflows101"><span class="header-section-number">5</span> Fundamental development workflows</a></li>
<li>
<a class="nav-link" href="#create-a-package"><span class="header-section-number">5.1</span> Create a package</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#survey-the-existing-landscape"><span class="header-section-number">5.1.1</span> Survey the existing landscape</a></li>
<li><a class="nav-link" href="#naming"><span class="header-section-number">5.1.2</span> Name your package</a></li>
<li><a class="nav-link" href="#creating"><span class="header-section-number">5.1.3</span> Package creation</a></li>
<li><a class="nav-link" href="#where-source-package"><span class="header-section-number">5.1.4</span> Where should you create_package()?</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#projects"><span class="header-section-number">5.2</span> RStudio Projects</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#benefits-of-rstudio-projects"><span class="header-section-number">5.2.1</span> Benefits of RStudio Projects</a></li>
<li><a class="nav-link" href="#how-to-get-an-rstudio-project"><span class="header-section-number">5.2.2</span> How to get an RStudio Project</a></li>
<li><a class="nav-link" href="#what-makes-an-rstudio-project"><span class="header-section-number">5.2.3</span> What makes an RStudio Project?</a></li>
<li><a class="nav-link" href="#how-to-launch-an-rstudio-project"><span class="header-section-number">5.2.4</span> How to launch an RStudio Project</a></li>
<li><a class="nav-link" href="#rstudio-project-vs.-active-usethis-project"><span class="header-section-number">5.2.5</span> RStudio Project vs. active usethis project</a></li>
</ul>
</li>
<li><a class="nav-link" href="#working-directory-and-filepath-discipline"><span class="header-section-number">5.3</span> Working directory and filepath discipline</a></li>
<li>
<a class="nav-link" href="#load-all"><span class="header-section-number">5.4</span> Test drive with load_all()</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#benefits-of-load_all"><span class="header-section-number">5.4.1</span> Benefits of load_all()</a></li>
<li><a class="nav-link" href="#other-ways-to-call-load_all"><span class="header-section-number">5.4.2</span> Other ways to call load_all()</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/hadley/r-pkgs/blob/main/Workflow101.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/hadley/r-pkgs/edit/main/Workflow101.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Packages</strong>" was written by Hadley Wickham, Jennifer Bryan. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
