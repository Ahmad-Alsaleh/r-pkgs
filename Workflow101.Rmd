# Fundamental development workflows {#workflows101}

```{r, include = FALSE}
source("common.R")
```

Having peeked under the hood of R packages and libraries in Chapter \@ref(package-structure-state), here
we provide the basic workflows for creating a package and moving it through the different states that come up during development.

## Survey the existing landscape

<!-- TODO: would love to put some version of the "geeks and repetitive tasks" figure here, but it would take more time than I want to spend right now to figure out original source, licensing, etc. Revisit when I do a concentrated push on figures. -->

Many packages are born out of one person's frustration at some common task that should be easier. How should you decide whether something is package-worthy? There's no definitive answer, but it's helpful to appreciate at least two types of payoff:

  * Product: your life will be better when this functionality is implemented
    formally, in a package.
  * Process: greater mastery of R will make you more effective in your work.
  
If all you care about is the existence of a product, then your main goal is to navigate the space of existing packages. Silge, Nash, and Graves organized a survey and sessions around this at useR!2017 and their write up for the R Journal [@silge-nash-graves] provides a comprehensive roundup of resources.

If you are looking for ways to increase your R mastery, you should still educate yourself about the landscape. But there are plenty of good reasons to make your own package, even if there is relevant prior work. The way experts got that way is by actually building things, often very basic things, and you deserve the same chance to learn by tinkering. If you're only allowed to work on things that have never been touched, you're likely looking at problems that are either very obscure or very difficult.

Finally, it's also valid to evaluate the suitability of existing tools on the basis of user interface, defaults, and edge case behaviour. If a package can technically do what you need, but it's very unergonomic for your use case, it's fair to say it doesn't meet your needs. In this case, it can still make sense for you to develop your own implementation or to write wrapper functions that hide the sharp edges.

## Naming your package {#naming}

> "There are only two hard things in Computer Science: cache invalidation and 
> naming things." 
>
> --- Phil Karlton

Before you can create your package, you need to come up with a name for it. This can be the hardest part of creating a package! (Not least because no one can automate it for you.)

### Formal requirements

There are three formal requirements:

  1. The name can only consist of letters, numbers, and periods, i.e., `.`.
  1. It must start with a letter.
  1. It cannot end with a period.
  
Unfortunately, this means you can't use either hyphens or underscores, i.e., `-` or `_`, in your package name. We recommend against using periods in package names, due to confusing associations with file extensions and S3 methods.

### Pragmatic advice

If you plan to share your package package with others, it's worth spending a few minutes to come up with a good name. Here are some things to consider:

* Pick a unique name that's easy to Google. This makes it easy for potential
  users to find your package (and associated resources) and for you to see who's
  using it.
  
* Don't pick a name that's already in use on CRAN or Bioconductor. You may
  also want to consider some other types of name collision:
  - Is there an in-development package maturing on, say, GitHub that already
    has some history and seems to be heading towards release?
  - Is this name already used for another piece of software or for a library or
    framework in, e.g., the Python or JavaScript ecosystem?

* Avoid using both upper and lower case letters: doing so makes the package name
  hard to type and even harder to remember. For example, it's hard to remember
  if it's Rgtk2 or RGTK2 or RGtk2.
  
* Give preference to names that are pronounceable, so people are comfortable
  talking about your package and have a way to hear it inside their head.

* Find a word that evokes the problem and modify it so that it's unique:

  - lubridate makes dates and times easier.
  - rvest "harvests" the content from web pages.
  - r2d3 provides utilities for working with D3 visualisations.
  - forcats is an anagram of factors, which we use __for__ __cat__egorical data.

* Use abbreviations: 

  - Rcpp = R + C++ (plus plus)
  - brms = Bayesian Regression Models using Stan

* Add an extra R: 

  - stringr provides string tools.
  - beepr plays notification sounds.
  - callr calls R, from R.
  
* Don't get sued.

  - If you're creating a package that talks to a commercial service, check the
    branding guidelines. For example, rDrop isn't called rDropbox because
    Dropbox prohibits any applications from using the full trademarked name.
    
Nick Tierney presents a fun typology of package names in his [Naming Things](https://www.njtierney.com/post/2018/06/20/naming-things/) blog post; see that for more inspiring examples. He also has some experience with renaming packages, so the post [So, you’ve decided to change your r package name](https://www.njtierney.com/post/2017/10/27/change-pkg-name/) is a good resource if you don't get this right the first time.
  
### Use the available package

It is impossible to abide by all of the above suggestions simultaneously, so obviously you will need to make some trade-offs. The [available package](https://cran.r-project.org/package=available) has a function called `available()` that helps you evaluate a potential package name from many angles:

```{r, eval = FALSE}
library(available)

available("doofus")
#> Urban Dictionary can contain potentially offensive results,
#>   should they be included? [Y]es / [N]o:
#> 1: 1
#> ── doofus ──────────────────────────────────────────────────────────────────
#> Name valid: ✔
#> Available on CRAN: ✔ 
#> Available on Bioconductor: ✔
#> Available on GitHub:  ✔ 
#> Abbreviations: http://www.abbreviations.com/doofus
#> Wikipedia: https://en.wikipedia.org/wiki/doofus
#> Wiktionary: https://en.wiktionary.org/wiki/doofus
#> Sentiment:???
```

`available::available()` does the following:

* Checks for validity.
* Checks availability on CRAN, Bioconductor, and beyond.
* Searches various websites to help you discover any unintended meanings. In an
  interactive session, the URLs you see above are opened in browser tabs.

## Creating a package {#getting-started}

Once you've come up with a name, there are two ways to create the package. You can use RStudio:

1. Click File | New Project.

2. Choose "New Directory":

    ```{r, echo = FALSE}
    knitr::include_graphics("images/create-1.png")
    ```
   
2. Then "R Package":

    ```{r, echo = FALSE}
    knitr::include_graphics("images/create-2.png")
    ```

2. Then give your package a name and click "Create Project":

    ```{r, echo = FALSE}
    knitr::include_graphics("images/create-3.png")
    ```
    
Alternatively, you can create a new package from within R by running

```{r, eval = FALSE}
usethis::create_package("path/to/package/pkgname")
```
    
Either route gets you to the same place: the smallest usable package, one with three components:

1. An `R/` directory, which you'll learn about in [R code](#r).

1. A basic `DESCRIPTION` file, which you'll learn about in 
   [package metadata](#description).

1. A basic `NAMESPACE` file, which you'll learn about in 
   [the namespace](#namespace).

It will also include an RStudio project file, `pkgname.Rproj`, that makes your package easy to use with RStudio, as described below.

Don't use `package.skeleton()` to create a package. Following that workflow actually creates more work for you because it creates extra files that you'll have to delete or modify before you can have a working package.

## RStudio projects {#projects}

To get started with your new package in RStudio, double-click the `pkgname.Rproj` file that `create()` just made. This will open a new RStudio project for your package. Projects are a great way to develop packages because:

*   Each project is isolated; code run in one project does not affect any 
    other project.

*   You get handy code navigation tools like `F2` to jump to a function
    definition and `Ctrl + .` to look up functions by name.

*   You get useful keyboard shortcuts for common package development tasks.
    You'll learn about them throughout the book. But to see them all, press 
    Alt + Shift + K or use the Help | Keyboard shortcuts menu.
    
    ```{r, echo = FALSE}
    knitr::include_graphics("images/keyboard-shortcuts.png")
    ```
   
(If you want to learn more RStudio tips and tricks, follow @[rstudiotips](https://twitter.com/rstudiotips) on twitter.)

Both RStudio and `usethis::create_package()` will make an `.Rproj` file for you. If you have an existing package that doesn't have an `.Rproj` file, you can use `usethis::use_rstudio("path/to/package")` to add it. If you don't use RStudio, you can get many of the benefits by starting a new R session and ensuring the working directory is set to the package directory. 

### What is an RStudio project file?

An `.Rproj` file is just a text file. The project file created by devtools looks like this:

```
Version: 1.0

RestoreWorkspace: No
SaveWorkspace: No
AlwaysSaveHistory: Default

EnableCodeIndexing: Yes
Encoding: UTF-8

AutoAppendNewline: Yes
StripTrailingWhitespace: Yes

BuildType: Package
PackageUseDevtools: Yes
PackageInstallArgs: --no-multiarch --with-keep.source
PackageRoxygenize: rd,collate,namespace
```

You don't need to modify this file by hand. Instead, use the friendly project options dialog box, accessible from the projects menu in the top-right corner of RStudio.

```{r, echo = FALSE, out.width="30%"}
knitr::include_graphics("images/project-options-1.png")
```
```{r, echo = FALSE, out.width="70%"}
knitr::include_graphics("images/project-options-2.png")
```
    
*TODO: re-integrate this diagram*    
    
```{r, echo = FALSE}
knitr::include_graphics("diagrams/loading.png")
```


[wre]:https://cran.r-project.org/doc/manuals/R-exts.html
[wre-tarball]:https://cran.r-project.org/doc/manuals/R-exts.html#Building-package-tarballs
[wre-binary]:https://cran.r-project.org/doc/manuals/R-exts.html#Building-binary-packages
[ria]:https://cran.r-project.org/doc/manuals/R-admin.html
[ria-install]:https://cran.r-project.org/doc/manuals/R-admin.html#Installing-packages
