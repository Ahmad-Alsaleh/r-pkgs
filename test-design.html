<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 14 Designing your test suite | R Packages</title>
<meta name="author" content="Hadley Wickham">
<meta name="author" content="Jennifer Bryan">
<meta name="description" content="Your test files should not include these library() calls. We also explicitly request testthat edition 3, but in a real package this will be declared in DESCRIPTION. library(testthat)...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="Chapter 14 Designing your test suite | R Packages">
<meta property="og:type" content="book">
<meta property="og:url" content="https://r-pkgs.org/test-design.html">
<meta property="og:image" content="https://r-pkgs.org/images/cover.png">
<meta property="og:description" content="Your test files should not include these library() calls. We also explicitly request testthat edition 3, but in a real package this will be declared in DESCRIPTION. library(testthat)...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 14 Designing your test suite | R Packages">
<meta name="twitter:site" content="@hadley">
<meta name="twitter:description" content="Your test files should not include these library() calls. We also explicitly request testthat edition 3, but in a real package this will be declared in DESCRIPTION. library(testthat)...">
<meta name="twitter:image" content="https://r-pkgs.org/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-141182576-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-141182576-1');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Packages</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome!</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li class="book-part">Getting started</li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="whole-game.html"><span class="header-section-number">2</span> The whole game</a></li>
<li><a class="" href="setup.html"><span class="header-section-number">3</span> System setup</a></li>
<li><a class="" href="package-structure-state.html"><span class="header-section-number">4</span> Package structure and state</a></li>
<li><a class="" href="workflows101.html"><span class="header-section-number">5</span> Fundamental development workflows</a></li>
<li><a class="" href="package-within.html"><span class="header-section-number">6</span> The package within</a></li>
<li class="book-part">Package components</li>
<li><a class="" href="r.html"><span class="header-section-number">7</span> R code</a></li>
<li><a class="" href="data.html"><span class="header-section-number">8</span> Data</a></li>
<li><a class="" href="misc.html"><span class="header-section-number">9</span> Other components</a></li>
<li class="book-part">Package metadata</li>
<li><a class="" href="description-and-namespace.html"><span class="header-section-number">10</span> DESCRIPTION and NAMESPACE</a></li>
<li><a class="" href="description-dependencies.html"><span class="header-section-number">11</span> Dependencies: What does your package need?</a></li>
<li><a class="" href="license.html"><span class="header-section-number">12</span> Licensing</a></li>
<li class="book-part">Testing</li>
<li><a class="" href="tests.html"><span class="header-section-number">13</span> Testing basics</a></li>
<li><a class="active" href="test-design.html"><span class="header-section-number">14</span> Designing your test suite</a></li>
<li><a class="" href="testing-advanced.html"><span class="header-section-number">15</span> Advanced testing techniques</a></li>
<li class="book-part">Documentation</li>
<li><a class="" href="man.html"><span class="header-section-number">16</span> Function documentation</a></li>
<li><a class="" href="vignettes.html"><span class="header-section-number">17</span> Vignettes</a></li>
<li><a class="" href="important-files.html"><span class="header-section-number">18</span> Other markdown files</a></li>
<li><a class="" href="website.html"><span class="header-section-number">19</span> Website</a></li>
<li class="book-part">Maintenance and distribution</li>
<li><a class="" href="r-cmd-check.html"><span class="header-section-number">20</span> R CMD check</a></li>
<li><a class="" href="continuous-integration.html"><span class="header-section-number">21</span> Continuous integration</a></li>
<li><a class="" href="release.html"><span class="header-section-number">22</span> Releasing to CRAN</a></li>
<li><a class="" href="lifecycle.html"><span class="header-section-number">23</span> Lifecycle</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/hadley/r-pkgs">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="test-design" class="section level1" number="14">
<h1>
<span class="header-section-number">14</span> Designing your test suite<a class="anchor" aria-label="anchor" href="#test-design"><i class="fas fa-link"></i></a>
</h1>
<div class="rmdnote">
<p>Your test files should not include these <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> calls.
We also explicitly request testthat edition 3, but in a real package this will be declared in DESCRIPTION.</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org">testthat</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/local_edition.html">local_edition</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="what-to-test" class="section level2" number="14.1">
<h2>
<span class="header-section-number">14.1</span> What to test<a class="anchor" aria-label="anchor" href="#what-to-test"><i class="fas fa-link"></i></a>
</h2>
<blockquote>
<p>Whenever you are tempted to type something into a print statement or a debugger expression, write it as a test instead.
— Martin Fowler</p>
</blockquote>
<p>There is a fine balance to writing tests.
Each test that you write makes your code less likely to change inadvertently; but it also can make it harder to change your code on purpose.
It’s hard to give good general advice about writing tests, but you might find these points helpful:</p>
<ul>
<li><p>Focus on testing the external interface to your functions - if you test the internal interface, then it’s harder to change the implementation in the future because as well as modifying the code, you’ll also need to update all the tests.</p></li>
<li><p>Strive to test each behaviour in one and only one test.
Then if that behaviour later changes you only need to update a single test.</p></li>
<li><p>Avoid testing simple code that you’re confident will work.
Instead focus your time on code that you’re not sure about, is fragile, or has complicated interdependencies.
That said, I often find I make the most mistakes when I falsely assume that the problem is simple and doesn’t need any tests.</p></li>
<li><p>Always write a test when you discover a bug.
You may find it helpful to adopt the test-first philosophy.
There you always start by writing the tests, and then write the code that makes them pass.
This reflects an important problem solving strategy: start by establishing your success criteria, how you know if you’ve solved the problem.</p></li>
</ul>
<div id="test-coverage" class="section level3" number="14.1.1">
<h3>
<span class="header-section-number">14.1.1</span> Test coverage<a class="anchor" aria-label="anchor" href="#test-coverage"><i class="fas fa-link"></i></a>
</h3>
<p>Another concrete way to direct your test writing efforts is to examine your test coverage.
The covr package (&lt;<a href="https://covr.r-lib.org" class="uri">https://covr.r-lib.org</a>) can be used to determine which lines of your package’s source code are (or are not!) executed when the test suite is run.
This is most often presented as a percentage.
Generally speaking, the higher the better.</p>
<p>In some technical sense, 100% test coverage is the goal, however, this is rarely achieved in practice and that’s often OK.
Going from 90% or 99% coverage to 100% is not always the best use of your development time and energy.
In many cases, that last 10% or 1% often requires some awkward gymnastics to cover.
Sometimes this forces you to introduce mocking or some other new complexity.
Don’t sacrifice the maintainability of your test suite in the name of covering some weird edge case that hasn’t yet proven to be a problem.
Also remember that not every line of code or every function is equally likely to harbor bugs.
Focus your testing energy on code that is tricky, based on your expert opinion and any empirical evidence you’ve accumulated about bug hot spots.</p>
<p>We use covr regularly, in two different ways:</p>
<ul>
<li>Local, interactive use. We mostly use <code><a href="https://devtools.r-lib.org/reference/test.html">devtools::test_coverage_active_file()</a></code> and <code><a href="https://devtools.r-lib.org/reference/test.html">devtools::test_coverage()</a></code>, for exploring the coverage of an individual file or the whole package, respectively.</li>
<li>Automatic, remote use via GitHub Actions (GHA). We cover continuous integration and GHA more thoroughly elsewhere, but we will at least mention here that <code>usethis::use_github_action("test-coverage")</code> configures a GHA workflow that constantly monitors your test coverage. Test coverage can be an especially helpful metric when evaluating a pull request (either your own or from an external contributor). A proposed change that is well-covered by tests is less risky to merge.</li>
</ul>
</div>
</div>
<div id="high-level-principles-for-testing" class="section level2" number="14.2">
<h2>
<span class="header-section-number">14.2</span> High-level principles for testing<a class="anchor" aria-label="anchor" href="#high-level-principles-for-testing"><i class="fas fa-link"></i></a>
</h2>
<p>In later sections, we offer concrete strategies for how to handle common testing dilemmas in R.
Here we lay out the high-level principles that underpin these recommendations:</p>
<ul>
<li>A test should ideally be self-sufficient and self-contained.</li>
<li>The interactive workflow is important, because you will mostly interact with your tests when they are failing.</li>
<li>It’s more important that test code be obvious than, e.g., as DRY as possible.</li>
<li>However, the interactive workflow shouldn’t “leak” into and undermine the test suite.</li>
</ul>
<p>Writing good tests for a code base often feels more challenging than writing the code in the first place.
This can come as a bit of a shock when you’re new to package development and you might be concerned that you’re doing it wrong.
Don’t worry, you’re not!
Testing presents many unique challenges and maneuvers, which tend to get much less air time in programming communities than strategies for writing the “main code”, i.e. the stuff below <code>R/</code>.
As a result, it requires more deliberate effort to develop your skills and taste around testing.</p>
<p>Many of the packages maintained by our team violate some of the advice you’ll find here.
There are (at least) two reasons for that:</p>
<ul>
<li>testthat has been evolving for more than twelve years and this chapter reflects the cumulative lessons learned from that experience. The tests in many packages have been in place for a long time and reflect typical practices from different eras and different maintainers.</li>
<li>These aren’t hard and fast rules, but are, rather, guidelines. There will always be specific situations where it makes sense to bend the rule.</li>
</ul>
<p>This chapter can’t address all possible testing situations, but hopefully these guidelines will help your future decision-making.</p>
<div id="self-sufficient-tests" class="section level3" number="14.2.1">
<h3>
<span class="header-section-number">14.2.1</span> Self-sufficient tests<a class="anchor" aria-label="anchor" href="#self-sufficient-tests"><i class="fas fa-link"></i></a>
</h3>
<blockquote>
<p>All tests should strive to be hermetic: a test should contain all of the information necessary to set up, execute, and tear down its environment.
Tests should assume as little as possible about the outside environment ….</p>
<p>From the book Software Engineering at Google, <a href="https://abseil.io/resources/swe-book/html/ch11.html">Chapter 11</a></p>
</blockquote>
<p>Recall this advice found in section <a href="r.html#code-r-landscape">7.6</a>, which covers your package’s “main code”, i.e. everything below <code>R/</code>:</p>
<blockquote>
<p>The <code>.R</code> files below <code>R/</code> should consist almost entirely of function definitions.
Any other top-level code is suspicious and should be carefully reviewed for possible conversion into a function.</p>
</blockquote>
<p>We have analogous advice for your test files:</p>
<blockquote>
<p>The <code>test-*.R</code> files below <code>tests/testthat/</code> should consist almost entirely of calls to <code><a href="https://testthat.r-lib.org/reference/test_that.html">test_that()</a></code>.
Any other top-level code is suspicious and should be carefully considered for relocation into calls to <code><a href="https://testthat.r-lib.org/reference/test_that.html">test_that()</a></code> or to other files that get special treatment inside an R package or from the testthat.</p>
</blockquote>
<p>Eliminating (or at least minimizing) top-level code outside of <code><a href="https://testthat.r-lib.org/reference/test_that.html">test_that()</a></code> will have the beneficial effect of making your tests more hermetic.
This is basically the testing analogue of the general programming advice that it’s wise to avoid unstructured sharing of state.</p>
<p>Logic at the top-level of a test file has an awkward scope: Objects or functions defined here have what you might call “test file scope”, if the definitions appear before the first call to <code><a href="https://testthat.r-lib.org/reference/test_that.html">test_that()</a></code>.
If top-level code is interleaved between <code><a href="https://testthat.r-lib.org/reference/test_that.html">test_that()</a></code> calls, you can even create “partial test file scope”.</p>
<p>While writing tests, it can feel convenient to rely on these file-scoped objects, especially early in the life of a test suite, e.g. when each test file fits on one screen.
But we find that implicitly relying on objects in a test’s parent environment tends to make a test suite harder to understand and maintain over time.</p>
<p>Consider a test file with top-level code sprinkled around it, outside of <code><a href="https://testthat.r-lib.org/reference/test_that.html">test_that()</a></code>:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="test-design.html#cb189-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb189-2"><a href="test-design.html#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="test-design.html#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="fu">skip_if</span>(<span class="fu">today_is_a_monday</span>())</span>
<span id="cb189-4"><a href="test-design.html#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="test-design.html#cb189-5" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"foofy() does this"</span>, {</span>
<span id="cb189-6"><a href="test-design.html#cb189-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">foofy</span>(dat), ...)</span>
<span id="cb189-7"><a href="test-design.html#cb189-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb189-8"><a href="test-design.html#cb189-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-9"><a href="test-design.html#cb189-9" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>))</span>
<span id="cb189-10"><a href="test-design.html#cb189-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-11"><a href="test-design.html#cb189-11" aria-hidden="true" tabindex="-1"></a><span class="fu">skip_on_os</span>(<span class="st">"windows"</span>)</span>
<span id="cb189-12"><a href="test-design.html#cb189-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-13"><a href="test-design.html#cb189-13" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"foofy2() does that"</span>, {</span>
<span id="cb189-14"><a href="test-design.html#cb189-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_snapshot</span>(<span class="fu">foofy2</span>(dat, dat2)</span>
<span id="cb189-15"><a href="test-design.html#cb189-15" aria-hidden="true" tabindex="-1"></a><span class="er">}</span>)</span></code></pre></div>
<p>We recommend relocating file-scoped logic to either a narrower scope or to a broader scope.
Here’s what it would look like to use a narrow scope, i.e. to inline everything inside <code><a href="https://testthat.r-lib.org/reference/test_that.html">test_that()</a></code> calls:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="test-design.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"foofy() does this"</span>, {</span>
<span id="cb190-2"><a href="test-design.html#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">skip_if</span>(<span class="fu">today_is_a_monday</span>())</span>
<span id="cb190-3"><a href="test-design.html#cb190-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb190-4"><a href="test-design.html#cb190-4" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb190-5"><a href="test-design.html#cb190-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb190-6"><a href="test-design.html#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">foofy</span>(dat), ...)</span>
<span id="cb190-7"><a href="test-design.html#cb190-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb190-8"><a href="test-design.html#cb190-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-9"><a href="test-design.html#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"foofy() does that"</span>, {</span>
<span id="cb190-10"><a href="test-design.html#cb190-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">skip_if</span>(<span class="fu">today_is_a_monday</span>())</span>
<span id="cb190-11"><a href="test-design.html#cb190-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">skip_on_os</span>(<span class="st">"windows"</span>)</span>
<span id="cb190-12"><a href="test-design.html#cb190-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb190-13"><a href="test-design.html#cb190-13" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb190-14"><a href="test-design.html#cb190-14" aria-hidden="true" tabindex="-1"></a>  dat2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>))</span>
<span id="cb190-15"><a href="test-design.html#cb190-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb190-16"><a href="test-design.html#cb190-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_snapshot</span>(<span class="fu">foofy</span>(dat, dat2)</span>
<span id="cb190-17"><a href="test-design.html#cb190-17" aria-hidden="true" tabindex="-1"></a><span class="er">}</span>)</span></code></pre></div>
<p>Below we will discuss techniques for moving file-scoped logic to a broader scope.</p>
</div>
<div id="self-contained-tests" class="section level3" number="14.2.2">
<h3>
<span class="header-section-number">14.2.2</span> Self-contained tests<a class="anchor" aria-label="anchor" href="#self-contained-tests"><i class="fas fa-link"></i></a>
</h3>
<p>Each <code><a href="https://testthat.r-lib.org/reference/test_that.html">test_that()</a></code> test has its own execution environment, which makes it somewhat self-contained.
For example, an R object you create inside a test does not exist after the test exits:</p>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"thingy"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"thingy exists"</span>, <span class="op">{</span></span>
<span>  <span class="va">thingy</span> <span class="op">&lt;-</span> <span class="st">"thingy"</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html">expect_true</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="va">thingy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Test passed</span> 🎉</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"thingy"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>The <code>thingy</code> object lives and dies entirely within the confines of <code><a href="https://testthat.r-lib.org/reference/test_that.html">test_that()</a></code>.
However, testthat doesn’t know how to cleanup after actions that affect other aspects of the R landscape:</p>
<ul>
<li>The filesystem: creating and deleting files, changing the working directory, etc.</li>
<li>The search path: <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>, <code><a href="https://rdrr.io/r/base/attach.html">attach()</a></code>.</li>
<li>Global options, like <code><a href="https://rdrr.io/r/base/options.html">options()</a></code> and <code><a href="https://rdrr.io/r/graphics/par.html">par()</a></code>, and environment variables.</li>
</ul>
<p>Watch how calls like <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>, <code><a href="https://rdrr.io/r/base/options.html">options()</a></code>, and <code><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv()</a></code> have a persistent effect <em>after</em> a test, even when they are executed inside <code><a href="https://testthat.r-lib.org/reference/test_that.html">test_that()</a></code>:</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"jsonlite"</span>, <span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; character(0)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"opt_whatever"</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"envvar_whatever"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"landscape changes leak outside the test"</span>, <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://arxiv.org/abs/1403.2805">jsonlite</a></span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>opt_whatever <span class="op">=</span> <span class="st">"whatever"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>envvar_whatever <span class="op">=</span> <span class="st">"whatever"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/expect_match.html">expect_match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"jsonlite"</span>, all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"opt_whatever"</span><span class="op">)</span>, <span class="st">"whatever"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"envvar_whatever"</span><span class="op">)</span>, <span class="st">"whatever"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Test passed</span> 🎉</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"jsonlite"</span>, <span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "package:jsonlite"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"opt_whatever"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "whatever"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"envvar_whatever"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "whatever"</span></span></code></pre></div>
<p>These changes to the landscape even persist beyond the current test file, i.e. they carry over into all subsequent test files.</p>
<p>If it’s easy to avoid making such changes in your test code, that is the best strategy!
But if it’s unavoidable, then you have to make sure that you clean up after yourself.
This mindset is very similar to one we advocated for in section <a href="r.html#code-r-landscape">7.6</a>, when discussing how to design well-mannered functions.</p>
<p>We like to use the withr package (<a href="https://withr.r-lib.org" class="uri">https://withr.r-lib.org</a>) to make temporary changes in global state, because it automatically captures the initial state and arranges the eventual restoration.
You’ve already seen an example of its usage, when we explored snapshot tests:</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"side-by-side diffs work"</span>, <span class="op">{</span></span>
<span>  <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html">local_options</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>             <span class="co"># &lt;-- (°_°) look here!</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/expect_snapshot.html">expect_snapshot</a></span><span class="op">(</span></span>
<span>    <span class="fu">waldo</span><span class="fu">::</span><span class="fu"><a href="https://waldo.r-lib.org/reference/compare.html">compare</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="va">letters</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">letters</span>, <span class="st">"X"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>This test requires the display width to be set at 20 columns, which is considerably less than the default width.
<code>withr::local_options(width = 20)</code> sets the <code>width</code> option to 20 and, at the end of the test, restores the option to its original value.
withr is also pleasant to use during interactive development: deferred actions are still captured on the global environment and can be executed explicitly via <code><a href="https://withr.r-lib.org/reference/defer.html">withr::deferred_run()</a></code> or implicitly by restarting R.</p>
<p>We recommend including withr in <code>Suggests</code>, if you’re only going to use it in your tests, or in <code>Imports</code>, if you also use it below <code>R/</code>.
Call withr functions as we do above, e.g. like <code>withr::local_whatever()</code>, in either case.
See section <a href="description-dependencies.html#suggested-packages-and-tests">11.2.1.1</a> for a full discussion.</p>
<div class="tip">
<p>The easiest way to add a package to DESCRIPTION is with, e.g., <code>usethis::use_package("withr", type = "Suggests")</code>.
For tidyverse packages, withr is considered a “free dependency”, i.e. the tidyverse uses withr so extensively that we don’t hesitate to use it whenever it would be useful.</p>
</div>
<p>withr has a large set of pre-implemented <code>local_*()</code> / <code>with_*()</code> functions that should handle most of your testing needs, so check there before you write your own.
If nothing exists that meets your need, <code><a href="https://withr.r-lib.org/reference/defer.html">withr::defer()</a></code> is the general way to schedule some action at the end of a test.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Base R’s &lt;code&gt;on.exit()&lt;/code&gt; is another alternative, but it requires more from you.
You need to capture the original state and write the restoration code yourself.
Also remember to do &lt;code&gt;on.exit(..., add = TRUE)&lt;/code&gt; if there’s &lt;em&gt;any&lt;/em&gt; chance a second &lt;code&gt;on.exit()&lt;/code&gt; call could be added in the test.
You probably also want to default to &lt;code&gt;after = FALSE&lt;/code&gt;.&lt;/p&gt;"><sup>30</sup></a></p>
<p>Here’s how we would fix the problems in the previous example using withr: <em>Behind the scenes, we reversed the landscape changes, so we can try this again.</em></p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"jsonlite"</span>, <span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; character(0)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"opt_whatever"</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"envvar_whatever"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"withr makes landscape changes local to a test"</span>, <span class="op">{</span></span>
<span>  <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_package.html">local_package</a></span><span class="op">(</span><span class="st">"jsonlite"</span><span class="op">)</span></span>
<span>  <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html">local_options</a></span><span class="op">(</span>opt_whatever <span class="op">=</span> <span class="st">"whatever"</span><span class="op">)</span></span>
<span>  <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_envvar.html">local_envvar</a></span><span class="op">(</span>envvar_whatever <span class="op">=</span> <span class="st">"whatever"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/expect_match.html">expect_match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"jsonlite"</span>, all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"opt_whatever"</span><span class="op">)</span>, <span class="st">"whatever"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"envvar_whatever"</span><span class="op">)</span>, <span class="st">"whatever"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Test passed</span> 😀</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"jsonlite"</span>, <span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; character(0)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"opt_whatever"</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"envvar_whatever"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] ""</span></span></code></pre></div>
<p>testthat leans heavily on withr to make test execution environments as reproducible and self-contained as possible.
In testthat 3e, <code><a href="https://testthat.r-lib.org/reference/local_test_context.html">testthat::local_reproducible_output()</a></code> is implicitly part of each <code><a href="https://testthat.r-lib.org/reference/test_that.html">test_that()</a></code> test.</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"something specific happens"</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/local_test_context.html">local_reproducible_output</a></span><span class="op">(</span><span class="op">)</span>     <span class="co"># &lt;-- this happens implicitly</span></span>
<span>  </span>
<span>  <span class="co"># your test code, which might be sensitive to ambient conditions, such as</span></span>
<span>  <span class="co"># display width or the number of supported colors</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="https://testthat.r-lib.org/reference/local_test_context.html">local_reproducible_output()</a></code> temporarily sets various options and environment variables to values favorable for testing, e.g. it suppresses colored output, turns off fancy quotes, sets the console width, and sets <code>LC_COLLATE = "C"</code>.
Usually, you can just passively enjoy the benefits of <code><a href="https://testthat.r-lib.org/reference/local_test_context.html">local_reproducible_output()</a></code>.
But you may want to call it explicitly when replicating test results interactively or if you want to override the default settings in a specific test.</p>
</div>
<div id="plan-for-test-failure" class="section level3" number="14.2.3">
<h3>
<span class="header-section-number">14.2.3</span> Plan for test failure<a class="anchor" aria-label="anchor" href="#plan-for-test-failure"><i class="fas fa-link"></i></a>
</h3>
<p>We regret to inform you that most of the quality time you spend with your tests will be when they are inexplicably failing.</p>
<blockquote>
<p>In its purest form, automating testing consists of three activities: writing tests, running tests, and <strong>reacting to test failures</strong>….</p>
<p>Remember that tests are often revisited only when something breaks.
When you are called to fix a broken test that you have never seen before, you will be thankful someone took the time to make it easy to understand.
Code is read far more than it is written, so make sure you write the test you’d like to read!</p>
<p>From the book Software Engineering at Google, <a href="https://abseil.io/resources/swe-book/html/ch11.html">Chapter 11</a></p>
</blockquote>
<p>Most of us don’t work on a code base the size of Google.
But even in a team of one, tests that you wrote six months ago might as well have been written by someone else.
Especially when they are failing.</p>
<p>When we do reverse dependency checks, often involving hundreds or thousands of CRAN packages, we have to inspect test failures to determine if changes in our packages are to blame.
As a result, we regularly engage with failing tests in other people’s packages, which leaves us with lots of opinions about practices that create unnecessary testing pain.</p>
<p>Test troubleshooting nirvana looks like this: In a fresh R session, you can do <code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all()</a></code> and immediately run an individual test or walk through it line-by-line.
There is no need to hunt around for setup code that has to be run manually first, that is found elsewhere in the test file or perhaps in a different file altogether.
Test-related code that lives in an unconventional location causes extra self-inflicted pain when you least need it.</p>
<p>Consider this extreme and abstract example of a test that is difficult to troubleshoot due to implicit dependencies on free-range code:</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dozens or hundreds of lines of top-level code, interspersed with other tests,</span></span>
<span><span class="co"># which you must read and selectively execute</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"f() works"</span>, <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">function_from_some_dependency</span><span class="op">(</span><span class="va">object_with_unknown_origin</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">2.5</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>This test is much easier to drop in on if dependencies are invoked in the normal way, i.e. via <code>::</code>, and test objects are created inline:</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dozens or hundreds of lines of self-sufficient, self-contained tests,</span></span>
<span><span class="co"># all of which you can safely ignore!</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"f() works"</span>, <span class="op">{</span></span>
<span>  <span class="va">useful_thing</span> <span class="op">&lt;-</span> <span class="va">...</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">somePkg</span><span class="fu">::</span><span class="fu">someFunction</span><span class="op">(</span><span class="va">useful_thing</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">2.5</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>This test is self-sufficient.
The code inside <code>{ ... }</code> explicitly creates any necessary objects or conditions and makes explicit calls to any helper functions.
This test doesn’t rely on objects or dependencies that happen to be be ambiently available.</p>
<p>Self-sufficient, self-contained tests are a win-win: It is literally safer to design tests this way and it also makes tests much easier for humans to troubleshoot later.</p>
</div>
<div id="repetition-is-ok" class="section level3" number="14.2.4">
<h3>
<span class="header-section-number">14.2.4</span> Repetition is OK<a class="anchor" aria-label="anchor" href="#repetition-is-ok"><i class="fas fa-link"></i></a>
</h3>
<p>One obvious consequence of our suggestion to minimize code with “file scope” is that your tests will probably have some repetition.
And that’s OK!
We’re going to make the controversial recommendation that you tolerate a fair amount of duplication in test code, i.e. you can relax some of your DRY (“don’t repeat yourself”) tendencies.</p>
<blockquote>
<p>Keep the reader in your test function.
Good production code is well-factored; good test code is obvious.
… think about what will make the problem obvious when a test fails.</p>
<p>From the blog post <a href="https://mtlynch.io/good-developers-bad-tests/">Why Good Developers Write Bad Unit Tests</a></p>
</blockquote>
<p>Here’s a toy example to make things concrete.</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"multiplication works"</span>, <span class="op">{</span></span>
<span>  <span class="va">useful_thing</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">useful_thing</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Test passed</span> 🥳</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"subtraction works"</span>, <span class="op">{</span></span>
<span>  <span class="va">useful_thing</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fl">5</span> <span class="op">-</span> <span class="va">useful_thing</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Test passed</span> 🌈</span></span></code></pre></div>
<p>In real life, <code>useful_thing</code> is usually a more complicated object that somehow feels burdensome to instantiate.
Notice how <code>useful_thing &lt;- 3</code> appears in more than once place.
Conventional wisdom says we should DRY this code out.
It’s tempting to just move <code>useful_thing</code>’s definition outside of the tests:</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">useful_thing</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"multiplication works"</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">useful_thing</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Test passed</span> 🥇</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"subtraction works"</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fl">5</span> <span class="op">-</span> <span class="va">useful_thing</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Test passed</span> 🥇</span></span></code></pre></div>
<p>But we really do think the first form, with the repetition, if often the better choice.</p>
<p>At this point, many readers might be thinking “but the code I might have to repeat is much longer than 1 line!”.
Below we describe the use of test fixtures.
This can often reduce complicated situations back to something that resembles this simple example.</p>
</div>
<div id="remove-tension-between-interactive-and-automated-testing" class="section level3" number="14.2.5">
<h3>
<span class="header-section-number">14.2.5</span> Remove tension between interactive and automated testing<a class="anchor" aria-label="anchor" href="#remove-tension-between-interactive-and-automated-testing"><i class="fas fa-link"></i></a>
</h3>
<p>Your test code will be executed in two different settings:</p>
<ul>
<li>Interactive test development and maintenance, which includes tasks like:
<ul>
<li>Initial test creation</li>
<li>Modifying tests to adapt to change</li>
<li>Debugging test failure</li>
</ul>
</li>
<li>Automated test runs, which is accomplished with functions such as:
<ul>
<li>Single file: <code><a href="https://devtools.r-lib.org/reference/test.html">devtools::test_active_file()</a></code>, <code><a href="https://testthat.r-lib.org/reference/test_file.html">testthat::test_file()</a></code>
</li>
<li>Whole package: <code><a href="https://devtools.r-lib.org/reference/test.html">devtools::test()</a></code>, <code><a href="https://devtools.r-lib.org/reference/check.html">devtools::check()</a></code>
</li>
</ul>
</li>
</ul>
<p>Automated testing of your whole package is what takes priority.
This is ultimately the whole point of your tests.
However, the interactive experience is clearly important for the humans doing this work.
Therefore it’s important to find a pleasant workflow, but also to ensure that you don’t rig anything for interactive convenience that actually compromises the health of the test suite.</p>
<p>These two modes of test-running should not be in conflict with each other.
If you perceive tension between these two modes, this can indicate that you’re not taking full advantage of some of testthat’s features and the way it’s designed to work with <code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all()</a></code>.</p>
<p>When working on your tests, use <code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code>, just like you do when working below <code>R/</code>.
By default, <code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code> does all of these things:</p>
<ul>
<li>Simulates re-building, re-installing, and re-loading your package.</li>
<li>Makes everything in your package’s namespace available, including unexported functions and objects and anything you’ve imported from another package.</li>
<li>Attaches testthat, i.e. does <code><a href="https://testthat.r-lib.org">library(testthat)</a></code>.</li>
<li>Runs test helper files, i.e. executes <code>test/testthat/helper.R</code> (more on that below).</li>
</ul>
<p>This eliminates the need for any <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> calls below <code>tests/testthat/</code>, for the vast majority of R packages.
Any instance of <code><a href="https://testthat.r-lib.org">library(testthat)</a></code> is clearly no longer necessary.
Likewise, any instance of attaching one of your dependencies via <code><a href="https://rdrr.io/r/base/library.html">library(somePkg)</a></code> is unnecessary.
In your tests, if you need to call functions from somePkg, do it just as you do below <code>R/</code>.
If you have imported the function into your namespace, use <code>fun()</code>.
If you have not, use <code>somePkg::fun()</code>.
It’s fair to say that <code><a href="https://rdrr.io/r/base/library.html">library(somePkg)</a></code> in the tests should be about as rare as taking a dependency via <code>Depends</code>, i.e. there is almost always a better alternative.</p>
<p>Unnecessary calls to <code><a href="https://rdrr.io/r/base/library.html">library(somePkg)</a></code> in test files have a real downside, because they actually change the R landscape.
<code><a href="https://rdrr.io/r/base/library.html">library()</a></code> alters the search path.
This means the circumstances under which you are testing may not necessarily reflect the circumstances under which your package will be used.
This makes it easier to create subtle test bugs, which you will have to unravel in the future.</p>
<p>One other function that should almost never appear below <code>tests/testhat/</code> is <code><a href="https://rdrr.io/r/base/source.html">source()</a></code>.
There are several special files with an official role in testthat workflows (see below), not to mention the entire R package machinery, that provide better ways to make functions, objects, and other logic available in your tests.</p>
</div>
</div>
<div id="tests-files-overview" class="section level2" number="14.3">
<h2>
<span class="header-section-number">14.3</span> Files relevant to testing<a class="anchor" aria-label="anchor" href="#tests-files-overview"><i class="fas fa-link"></i></a>
</h2>
<p>Here we review which package files are especially relevant to testing and, more generally, best practices for interacting with the file system from your tests.</p>
<div id="hiding-in-plain-sight-files-below-r" class="section level3" number="14.3.1">
<h3>
<span class="header-section-number">14.3.1</span> Hiding in plain sight: files below <code>R/</code><a class="anchor" aria-label="anchor" href="#hiding-in-plain-sight-files-below-r"><i class="fas fa-link"></i></a>
</h3>
<p>The most important functions you’ll need to access from your tests are clearly those in your package!
Here we’re talking about everything that’s defined below <code>R/</code>.
The functions and other objects defined by your package are always available when testing, regardless of whether they are exported or not.
For interactive work, <code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all()</a></code> takes care of this.
During automated testing, this is taken care of internally by testthat.</p>
<p>This implies that test helpers can absolutely be defined below <code>R/</code> and used freely in your tests.
It might make sense to gather such helpers in a clearly marked file, such as one of these:</p>
<pre><code>.                              
├── ...
└── R
    ├── ...
    ├── test-helpers.R
    ├── test-utils.R
    ├── utils-testing.R
    └── ...</code></pre>
</div>
<div id="teststesthat.r" class="section level3" number="14.3.2">
<h3>
<span class="header-section-number">14.3.2</span> <code>tests/testhat.R</code><a class="anchor" aria-label="anchor" href="#teststesthat.r"><i class="fas fa-link"></i></a>
</h3>
<p>Recall the initial testthat setup described in section <a href="tests.html#tests-mechanics-workflow">13.4</a>: The standard <code>tests/testhat.R</code> file looks like this:</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org">testthat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">abcde</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_package.html">test_check</a></span><span class="op">(</span><span class="st">"abcde"</span><span class="op">)</span></span></code></pre></div>
<p>We repeat the advice to not edit <code>tests/testthat.R</code>.
It is run during <code>R CMD check</code> (and, therefore, <code><a href="https://devtools.r-lib.org/reference/check.html">devtools::check()</a></code>), but is not used in most other test-running scenarios (such as <code><a href="https://devtools.r-lib.org/reference/test.html">devtools::test()</a></code> or <code><a href="https://devtools.r-lib.org/reference/test.html">devtools::test_active_file()</a></code> or during interactive development).
Do not attach your dependencies here with <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>.
Call them in your tests in the same manner as you do below <code>R/</code>.</p>
</div>
<div id="testthat-helper-files" class="section level3" number="14.3.3">
<h3>
<span class="header-section-number">14.3.3</span> Testthat helper files<a class="anchor" aria-label="anchor" href="#testthat-helper-files"><i class="fas fa-link"></i></a>
</h3>
<p>Another type of file that is always executed by <code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code> and at the beginning of automated testing is a helper file, defined as any file below <code>tests/testthat/</code> that begins with <code>helper</code>.
Helper files are a mighty weapon in the battle to eliminate code floating around at the top-level of test files.
Helper files are a prime example of what we mean when we recommend moving such code into a broader scope.
Objects or functions defined in a helper file are available to all of your tests.</p>
<p>If you have just one such file, you should probably name it <code>helper.R</code>.
If you organize your helpers into multiple files, you could include a suffix with additional info.
Here are examples of how such files might look:</p>
<pre><code>.                              
├── ...
└── tests
    ├── testthat
    │   ├── helper.R
    │   ├── helper-blah.R
    │   ├── helper-foo.R    
    │   ├── test-foofy.R
    │   └── (more test files)
    └── testthat.R</code></pre>
<p>Many developers use helper files to define custom test helper functions, which we describe in detail below.
Compared to defining helpers below <code>R/</code>, some people find that <code>tests/testthat/helper.R</code> makes it more clear that these utilities are specifically for testing the package.
This location also feels more natural if your helpers rely on testthat functions.</p>
<p>A helper file is also a good location for setup code that is needed for its side effects.
This is a case where <code>tests/testthat/helper.R</code> is clearly more appropriate than a file below <code>R/</code>.
For example, in an API-wrapping package, <code>helper.R</code> is a good place to (attempt to) authenticate with the testing credentials.</p>
</div>
<div id="testthat-setup-files" class="section level3" number="14.3.4">
<h3>
<span class="header-section-number">14.3.4</span> Testthat setup files<a class="anchor" aria-label="anchor" href="#testthat-setup-files"><i class="fas fa-link"></i></a>
</h3>
<p>Testthat has one more special file type: setup files, defined as any file below <code>test/testthat/</code> that begins with <code>setup</code>.
Here’s an example of how that might look:</p>
<pre><code>.                              
├── ...
└── tests
    ├── testthat
    │   ├── helper.R
    │   ├── setup.R
    │   ├── test-foofy.R
    │   └── (more test files)
    └── testthat.R</code></pre>
<p>A setup file is handled almost exactly like a helper file, but with two big differences:</p>
<ul>
<li>Setup files are not executed by <code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all()</a></code>.</li>
<li>Setup files often contain the corresponding teardown code.</li>
</ul>
<p>Setup files are good for global test setup that is tailored for test execution in non-interactive or remote environments.
For example, you might turn off behaviour that’s aimed at an interactive user, such as messaging or writing to the clipboard.</p>
<p>If any of your setup should be reversed after test execution, you should also include the necessary teardown code in <code>setup.R</code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;A legacy approach (which still works, but is no longer recommended) is to put teardown code in &lt;code&gt;tests/testthat/teardown.R&lt;/code&gt;.&lt;/p&gt;"><sup>31</sup></a>.
We recommend maintaining teardown code alongside the setup code, in <code>setup.R</code>, because this makes it easier to ensure they stay in sync.
The artificial environment <code><a href="https://testthat.r-lib.org/reference/teardown_env.html">teardown_env()</a></code> exists as a magical handle to use in <code><a href="https://withr.r-lib.org/reference/defer.html">withr::defer()</a></code> and <code>withr::local_*()</code> / <code>withr::with_*()</code>.</p>
<p>Here’s a <code>setup.R</code> example from the reprex package, where we turn off clipboard and HTML preview functionality during testing:</p>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>reprex.clipboard <span class="op">=</span> <span class="cn">FALSE</span>, reprex.html_preview <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/defer.html">defer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span>, <span class="fu"><a href="https://testthat.r-lib.org/reference/teardown_env.html">teardown_env</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Since we are just modifying options here, we can be even more concise and use the pre-built function <code><a href="https://withr.r-lib.org/reference/with_options.html">withr::local_options()</a></code> and pass <code><a href="https://testthat.r-lib.org/reference/teardown_env.html">teardown_env()</a></code> as the <code>.local_envir</code>:</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html">local_options</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>reprex.clipboard <span class="op">=</span> <span class="cn">FALSE</span>, reprex.html_preview <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  .local_envir <span class="op">=</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/teardown_env.html">teardown_env</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="files-ignored-by-testthat" class="section level3" number="14.3.5">
<h3>
<span class="header-section-number">14.3.5</span> Files ignored by testthat<a class="anchor" aria-label="anchor" href="#files-ignored-by-testthat"><i class="fas fa-link"></i></a>
</h3>
<p>testthat only automatically executes files where these are both true:</p>
<ul>
<li>File is a direct child of <code>tests/testthat/</code>
</li>
<li>File name starts with one of the specific strings:
<ul>
<li><code>helper</code></li>
<li><code>setup</code></li>
<li><code>test</code></li>
</ul>
</li>
</ul>
<p>It is fine to have other files or directories in <code>tests/testthat/</code>, but testthat won’t automatically do anything with them (other than the <code>_snaps</code> directory, which holds snapshots).</p>
</div>
<div id="storing-test-data" class="section level3" number="14.3.6">
<h3>
<span class="header-section-number">14.3.6</span> Storing test data<a class="anchor" aria-label="anchor" href="#storing-test-data"><i class="fas fa-link"></i></a>
</h3>
<p>Many packages contain files that hold test data.
Where should these be stored?
The best location is somewhere below <code>tests/testthat/</code>, often in a subdirectory, to keep things neat.
Below is an example, where <code>useful_thing1.rds</code> and <code>useful_thing2.rds</code> hold objects used in the test files.</p>
<pre><code>.
├── ...
└── tests
    ├── testthat
    │   ├── fixtures
    │   │   ├── make-useful-things.R
    │   │   ├── useful_thing1.rds
    │   │   └── useful_thing2.rds
    │   ├── helper.R
    │   ├── setup.R
    │   └── (all the test files)
    └── testthat.R</code></pre>
<p>Then, in your tests, use <code><a href="https://testthat.r-lib.org/reference/test_path.html">testthat::test_path()</a></code> to build a robust filepath to such files.</p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"foofy() does this"</span>, <span class="op">{</span></span>
<span>  <span class="va">useful_thing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_path.html">test_path</a></span><span class="op">(</span><span class="st">"fixtures"</span>, <span class="st">"useful_thing1.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># ...</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="https://testthat.r-lib.org/reference/test_path.html">testthat::test_path()</a></code> is extremely handy, because it produces the correct path in the two important modes of test execution:</p>
<ul>
<li>Interactive test development and maintenance, where working directory is presumably set to the top-level of the package.</li>
<li>Automated testing, where working directory is usually set to something below <code>tests/</code>.</li>
</ul>
</div>
<div id="tests-files-where-write" class="section level3" number="14.3.7">
<h3>
<span class="header-section-number">14.3.7</span> Where to write files during testing<a class="anchor" aria-label="anchor" href="#tests-files-where-write"><i class="fas fa-link"></i></a>
</h3>
<p>If it’s easy to avoid writing files from you tests, that is definitely the best plan.
But there are many times when you really must write files.</p>
<p><strong>You should only write files inside the session temp directory.</strong> Do not write into your package’s <code>tests/</code> directory.
Do not write into the current working directory.
Do not write into the user’s home directory.
Even though you are writing into the session temp directory, you should still clean up after yourself, i.e. delete any files you’ve written.</p>
<p>Most package developers don’t want to hear this, because it sounds like a hassle.
But it’s not that burdensome once you get familiar with a few techniques and build some new habits.
A high level of file system discipline also eliminates various testing bugs and will absolutely make your CRAN life run more smoothly.</p>
<p>This test is from roxygen2 and demonstrates everything we recommend:</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"can read from file name with utf-8 path"</span>, <span class="op">{</span></span>
<span>  <span class="va">path</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_tempfile.html">local_tempfile</a></span><span class="op">(</span></span>
<span>    pattern <span class="op">=</span> <span class="st">"Universit\u00e0-"</span>,</span>
<span>    lines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#' @include foo.R"</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fu">find_includes</span><span class="op">(</span><span class="va">path</span><span class="op">)</span>, <span class="st">"foo.R"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="https://withr.r-lib.org/reference/with_tempfile.html">withr::local_tempfile()</a></code> creates a file within the session temp directory whose lifetime is tied to the “local” environment – in this case, the execution environment of an individual test.
It is a wrapper around <code><a href="https://rdrr.io/r/base/tempfile.html">base::tempfile()</a></code> and passes, e.g., the <code>pattern</code> argument through, so you have some control over the file name.
You can optionally provide <code>lines</code> to populate the file with at creation time or you can write to the file in all the usual ways in subsequent steps.
Finally, with no special effort on your part, the temporary file will automatically be deleted at the end of the test.</p>
<p>Sometimes you need even more control over the file name.
In that case, you can use <code><a href="https://withr.r-lib.org/reference/with_tempfile.html">withr::local_tempdir()</a></code> to create a self-deleting temporary directory and write intentionally-named files inside this directory.</p>

</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="tests.html"><span class="header-section-number">13</span> Testing basics</a></div>
<div class="next"><a href="testing-advanced.html"><span class="header-section-number">15</span> Advanced testing techniques</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#test-design"><span class="header-section-number">14</span> Designing your test suite</a></li>
<li>
<a class="nav-link" href="#what-to-test"><span class="header-section-number">14.1</span> What to test</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#test-coverage"><span class="header-section-number">14.1.1</span> Test coverage</a></li></ul>
</li>
<li>
<a class="nav-link" href="#high-level-principles-for-testing"><span class="header-section-number">14.2</span> High-level principles for testing</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#self-sufficient-tests"><span class="header-section-number">14.2.1</span> Self-sufficient tests</a></li>
<li><a class="nav-link" href="#self-contained-tests"><span class="header-section-number">14.2.2</span> Self-contained tests</a></li>
<li><a class="nav-link" href="#plan-for-test-failure"><span class="header-section-number">14.2.3</span> Plan for test failure</a></li>
<li><a class="nav-link" href="#repetition-is-ok"><span class="header-section-number">14.2.4</span> Repetition is OK</a></li>
<li><a class="nav-link" href="#remove-tension-between-interactive-and-automated-testing"><span class="header-section-number">14.2.5</span> Remove tension between interactive and automated testing</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#tests-files-overview"><span class="header-section-number">14.3</span> Files relevant to testing</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#hiding-in-plain-sight-files-below-r"><span class="header-section-number">14.3.1</span> Hiding in plain sight: files below R/</a></li>
<li><a class="nav-link" href="#teststesthat.r"><span class="header-section-number">14.3.2</span> tests/testhat.R</a></li>
<li><a class="nav-link" href="#testthat-helper-files"><span class="header-section-number">14.3.3</span> Testthat helper files</a></li>
<li><a class="nav-link" href="#testthat-setup-files"><span class="header-section-number">14.3.4</span> Testthat setup files</a></li>
<li><a class="nav-link" href="#files-ignored-by-testthat"><span class="header-section-number">14.3.5</span> Files ignored by testthat</a></li>
<li><a class="nav-link" href="#storing-test-data"><span class="header-section-number">14.3.6</span> Storing test data</a></li>
<li><a class="nav-link" href="#tests-files-where-write"><span class="header-section-number">14.3.7</span> Where to write files during testing</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/hadley/r-pkgs/blob/main/testing-design.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/hadley/r-pkgs/edit/main/testing-design.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Packages</strong>" was written by Hadley Wickham, Jennifer Bryan. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
